<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.2" />
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html,
      body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia('(prefers-color-scheme: dark)').matches
      if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
        document.documentElement.classList.toggle('dark', true)
      }
    </script>
    <meta property="og:url" content="https://bitbitpulse.github.io/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html"><meta property="og:site_name" content="Bitbitpulse"><meta property="og:title" content="SpringSecurity实现前后端分离应用的认证与授权"><meta property="og:description" content="SpringSecurity实现前后端分离应用的认证与授权 版本信息： JDK 17 Maven 3.8.2 Spring Boot 3.2.1 Spring Security 6.2.1 MyBatis 3.0.3 准备工作 创建SpringBoot项目，并引入SpringSecurity。 添加依赖 创建启动类 创建配置文件application...."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"SpringSecurity实现前后端分离应用的认证与授权","image":[""],"dateModified":null,"author":[]}</script><meta name="google-site-verification" content="sEYB4YNABdmY-WLmAR1b3oSYTW-kjiWKLqlw4rvvR14"><link rel="icon" href="/logo.gif"><script type="text/javascript">var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?67c8f19b27fc99be208ca3ef56c999ef";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><link rel="alternate" type="application/rss+xml" href="https://bitbitpulse.github.io/rss.xml" title="Bitbitpulse RSS Feed"><title>SpringSecurity实现前后端分离应用的认证与授权 | Bitbitpulse</title><meta name="description" content="SpringSecurity实现前后端分离应用的认证与授权 版本信息： JDK 17 Maven 3.8.2 Spring Boot 3.2.1 Spring Security 6.2.1 MyBatis 3.0.3 准备工作 创建SpringBoot项目，并引入SpringSecurity。 添加依赖 创建启动类 创建配置文件application....">
    <link rel="preload" href="/assets/style-NKoIq6W2.css" as="style"><link rel="stylesheet" href="/assets/style-NKoIq6W2.css">
    <link rel="modulepreload" href="/assets/app-HBA039kk.js">
    <link rel="prefetch" href="/assets/index.html-c2C15s_l.js" as="script"><link rel="prefetch" href="/assets/index.html-eDcWV2qz.js" as="script"><link rel="prefetch" href="/assets/index.html-LsZXxKmx.js" as="script"><link rel="prefetch" href="/assets/index.html-tUM_QDUn.js" as="script"><link rel="prefetch" href="/assets/index.html-KvSBXtMk.js" as="script"><link rel="prefetch" href="/assets/index.html-kCqVDntx.js" as="script"><link rel="prefetch" href="/assets/项目A.html-EOrfxyID.js" as="script"><link rel="prefetch" href="/assets/index.html-gXPCol-G.js" as="script"><link rel="prefetch" href="/assets/早起的一天.html-eQEskYuk.js" as="script"><link rel="prefetch" href="/assets/index.html-HwiV2k_U.js" as="script"><link rel="prefetch" href="/assets/index.html-xoIKeZXB.js" as="script"><link rel="prefetch" href="/assets/charlse.html-8HAAKlxW.js" as="script"><link rel="prefetch" href="/assets/docker入门.html-zPPRivuK.js" as="script"><link rel="prefetch" href="/assets/docker环境搭建.html-NtqP2fdP.js" as="script"><link rel="prefetch" href="/assets/fidller.html-DZZqCJ8h.js" as="script"><link rel="prefetch" href="/assets/github入门.html-3fGkBsQe.js" as="script"><link rel="prefetch" href="/assets/git入门.html-Pb2c0Xn-.js" as="script"><link rel="prefetch" href="/assets/gradle入门.html-JJEomrdR.js" as="script"><link rel="prefetch" href="/assets/index.html-lIpBrPTg.js" as="script"><link rel="prefetch" href="/assets/Intelij IDEA.html-nzCMV4gd.js" as="script"><link rel="prefetch" href="/assets/maven入门.html-0VcQmii3.js" as="script"><link rel="prefetch" href="/assets/navicat.html-W5IgjxRv.js" as="script"><link rel="prefetch" href="/assets/postman.html-tlOMTlD2.js" as="script"><link rel="prefetch" href="/assets/svn入门.html-QK1fnD2l.js" as="script"><link rel="prefetch" href="/assets/uml.html-muCgsyAw.js" as="script"><link rel="prefetch" href="/assets/VirtualBox.html-WP-vcOJc.js" as="script"><link rel="prefetch" href="/assets/vmware.html-bpgE1HaK.js" as="script"><link rel="prefetch" href="/assets/vscode.html-YkYtuORn.js" as="script"><link rel="prefetch" href="/assets/WinSCP.html-eX1AniUd.js" as="script"><link rel="prefetch" href="/assets/wireshark.html-4E-uApo5.js" as="script"><link rel="prefetch" href="/assets/XShell.html-1mtSU9ug.js" as="script"><link rel="prefetch" href="/assets/index.html-mvl4js7f.js" as="script"><link rel="prefetch" href="/assets/VPN搭建.html-4CZZ6Eog.js" as="script"><link rel="prefetch" href="/assets/index.html-NKF8GvZh.js" as="script"><link rel="prefetch" href="/assets/minecraft开发环境搭建.html-zw7EO7oK.js" as="script"><link rel="prefetch" href="/assets/index.html-hUnZ3B9N.js" as="script"><link rel="prefetch" href="/assets/index.html-faHOYxFC.js" as="script"><link rel="prefetch" href="/assets/index.html-4PxR71be.js" as="script"><link rel="prefetch" href="/assets/index.html-wtKwrZPh.js" as="script"><link rel="prefetch" href="/assets/index.html-jgGxYs7w.js" as="script"><link rel="prefetch" href="/assets/axure.html-MAUi-DSr.js" as="script"><link rel="prefetch" href="/assets/index.html-bkMrCPDk.js" as="script"><link rel="prefetch" href="/assets/MinIO Typora PicGo搭建个人图床服务.html-00K38bPF.js" as="script"><link rel="prefetch" href="/assets/typora.html-cPQSwM1M.js" as="script"><link rel="prefetch" href="/assets/index.html-uvfQDElZ.js" as="script"><link rel="prefetch" href="/assets/index.html-MHQRBmci.js" as="script"><link rel="prefetch" href="/assets/index.html-SCD1mXCb.js" as="script"><link rel="prefetch" href="/assets/index.html-WuxENO55.js" as="script"><link rel="prefetch" href="/assets/index.html-sMdLL-W5.js" as="script"><link rel="prefetch" href="/assets/在线商城系统表设计.html-TuFhpBtG.js" as="script"><link rel="prefetch" href="/assets/权限管理系统设计.html-y0VWNi88.js" as="script"><link rel="prefetch" href="/assets/index.html-mRKai30c.js" as="script"><link rel="prefetch" href="/assets/浏览器跨域.html-xH_nAE_H.js" as="script"><link rel="prefetch" href="/assets/index.html-azZb4KC6.js" as="script"><link rel="prefetch" href="/assets/MongoDB安装.html-rzT1arrp.js" as="script"><link rel="prefetch" href="/assets/mysql事务.html-hkG-6-vB.js" as="script"><link rel="prefetch" href="/assets/MySQL安装.html-96-fcZST.js" as="script"><link rel="prefetch" href="/assets/mysql索引.html-q8LHapKU.js" as="script"><link rel="prefetch" href="/assets/mysql集群.html-gjE8BE1_.js" as="script"><link rel="prefetch" href="/assets/PostgreSQL函数.html-zvOS8GO-.js" as="script"><link rel="prefetch" href="/assets/PostgreSQL安装.html-A93_9_lB.js" as="script"><link rel="prefetch" href="/assets/Redis客户端.html-9fVwU-Nn.js" as="script"><link rel="prefetch" href="/assets/Redis应用场景.html-EThN6SvJ.js" as="script"><link rel="prefetch" href="/assets/Redis数据结构.html-Oa-v4ii6.js" as="script"><link rel="prefetch" href="/assets/Redis环境搭建.html-g3QfAeCV.js" as="script"><link rel="prefetch" href="/assets/Redis高可用机制.html-Hy65q39f.js" as="script"><link rel="prefetch" href="/assets/Redis高级特性.html-ruFUDC30.js" as="script"><link rel="prefetch" href="/assets/sql增删改.html-ym4dXMtj.js" as="script"><link rel="prefetch" href="/assets/sql数据库和表.html-38rwQnmW.js" as="script"><link rel="prefetch" href="/assets/sql查询.html-lu8XBNcu.js" as="script"><link rel="prefetch" href="/assets/sql经典实例.html-Da7W6kJB.js" as="script"><link rel="prefetch" href="/assets/index.html-Q-fTjmzX.js" as="script"><link rel="prefetch" href="/assets/index.html-UUyBnGqC.js" as="script"><link rel="prefetch" href="/assets/index.html-yyAe4jUD.js" as="script"><link rel="prefetch" href="/assets/JSP.html-eKuPCgwK.js" as="script"><link rel="prefetch" href="/assets/Servlet.html-PiTlViaJ.js" as="script"><link rel="prefetch" href="/assets/Tomcat.html-t3tlPJon.js" as="script"><link rel="prefetch" href="/assets/index.html-3qj-SJ8k.js" as="script"><link rel="prefetch" href="/assets/index.html-0483ldr0.js" as="script"><link rel="prefetch" href="/assets/mybatis动态SQL.html-jX2VNwnO.js" as="script"><link rel="prefetch" href="/assets/mybatis增删改查.html-CsoSfb9Z.js" as="script"><link rel="prefetch" href="/assets/mybatis快速开始.html-Zd_l7YUB.js" as="script"><link rel="prefetch" href="/assets/mybatis插件.html-USxHegs1.js" as="script"><link rel="prefetch" href="/assets/mybatis配置.html-Le8eXEFA.js" as="script"><link rel="prefetch" href="/assets/index.html-fqw1jqe4.js" as="script"><link rel="prefetch" href="/assets/index.html-FrYEj00b.js" as="script"><link rel="prefetch" href="/assets/Java代理.html-8wjB34em.js" as="script"><link rel="prefetch" href="/assets/Java反射.html-W5ZCV0U0.js" as="script"><link rel="prefetch" href="/assets/Java文件与流.html-qNktNqAj.js" as="script"><link rel="prefetch" href="/assets/Java新特性总结.html-v5P-InAa.js" as="script"><link rel="prefetch" href="/assets/Java正则表达式.html-FmyAoXj6.js" as="script"><link rel="prefetch" href="/assets/Java泛型.html-DPEZzYPu.js" as="script"><link rel="prefetch" href="/assets/Java注解.html-3nPtjWgQ.js" as="script"><link rel="prefetch" href="/assets/Java集合.html-YSXAwAJt.js" as="script"><link rel="prefetch" href="/assets/Java面向对象编程核心思想.html-6O-MkqNl.js" as="script"><link rel="prefetch" href="/assets/index.html-5PTjgUDJ.js" as="script"><link rel="prefetch" href="/assets/index.html-r1vTQ8Pk.js" as="script"><link rel="prefetch" href="/assets/SpringBoot使用事务.html-5HMjbcyK.js" as="script"><link rel="prefetch" href="/assets/SpringBoot使用定时任务.html-4wFfg_ux.js" as="script"><link rel="prefetch" href="/assets/SpringBoot使用异步任务.html-97XatCyE.js" as="script"><link rel="prefetch" href="/assets/SpringBoot使用拦截器.html-aG3Bn-V1.js" as="script"><link rel="prefetch" href="/assets/SpringBoot单元测试.html-ebEwzI0r.js" as="script"><link rel="prefetch" href="/assets/SpringBoot参数校验.html-Vr68aRqR.js" as="script"><link rel="prefetch" href="/assets/SpringBoot国际化支持.html-lj4LAG4Q.js" as="script"><link rel="prefetch" href="/assets/SpringBoot处理JSON数据.html-ZNuDDlCT.js" as="script"><link rel="prefetch" href="/assets/SpringBoot快速开始.html-6Syp5iOc.js" as="script"><link rel="prefetch" href="/assets/SpringBoot日志.html-MNOohNG4.js" as="script"><link rel="prefetch" href="/assets/SpringBoot核心特性-Actuator.html-YlExngg5.js" as="script"><link rel="prefetch" href="/assets/SpringBoot核心特性-CLI.html-swW7_ObN.js" as="script"><link rel="prefetch" href="/assets/SpringBoot核心特性-devtools.html-7j9QlCV3.js" as="script"><link rel="prefetch" href="/assets/SpringBoot核心特性-SpringApplication类.html-5vHXG17Q.js" as="script"><link rel="prefetch" href="/assets/SpringBoot核心特性-starter启动器.html-4NYWfqZo.js" as="script"><link rel="prefetch" href="/assets/SpringBoot核心特性-外部化配置.html-NN5lb9NE.js" as="script"><link rel="prefetch" href="/assets/SpringBoot核心特性-嵌入式WebServer.html-xjtyahNc.js" as="script"><link rel="prefetch" href="/assets/SpringBoot核心特性-自动配置.html-It7rt-US.js" as="script"><link rel="prefetch" href="/assets/SpringBoot统一处理响应.html-BsfIEeHE.js" as="script"><link rel="prefetch" href="/assets/index.html-E0H5IOrr.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Alibaba Nacos注册中心.html-TM0c9HHy.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Alibaba Nacos部署.html-ktjxU90z.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Alibaba Nacos配置中心.html-YQKk9sg8.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Alibaba Seata分布式事务.html-1RqEku_j.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Alibaba Sentinel断路器.html-qNFTT6H2.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Bus消息总线.html-vZDxlQ1Q.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud CircuitBreaker断路器.html-mz55rjXY.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Config配置中心.html-bSpXaW5F.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Consul注册中心.html-tDdehua2.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Consul配置中心.html-rzSy3oGl.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Gateway API网关.html-N1cI44_N.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Netflix Eureka注册中心.html-LcMEdG0v.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Netflix Hystrix断路器.html-Kv19mMTb.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Netflix Zuul API网关.html-6mw_Bz-R.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Sleuth链路跟踪.html-tiv5xrPe.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Stream消息驱动.html-_aogngo8.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Zookeeper注册中心.html-LBiR7uG2.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Zookeeper配置中心.html-9IIeZGBQ.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud服务调用与客户端负载均衡.html-diOFRKxy.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud项目环境搭建.html-oDLR8PFQ.js" as="script"><link rel="prefetch" href="/assets/分布式系统中全局唯一ID实现方案.html-78DYlWt2.js" as="script"><link rel="prefetch" href="/assets/微服务理论知识.html-oIrfdfgo.js" as="script"><link rel="prefetch" href="/assets/index.html-ArDeO5Bq.js" as="script"><link rel="prefetch" href="/assets/Spring AOP编程.html-fdtON95w.js" as="script"><link rel="prefetch" href="/assets/Spring IoC容器.html-_mxcY9YV.js" as="script"><link rel="prefetch" href="/assets/Spring MVC.html-vrHTV_TL.js" as="script"><link rel="prefetch" href="/assets/Spring快速开始.html-FFzLQiQb.js" as="script"><link rel="prefetch" href="/assets/Spring表达式语言SpEL.html-Pfe_susq.js" as="script"><link rel="prefetch" href="/assets/index.html-s0gzHdV6.js" as="script"><link rel="prefetch" href="/assets/OAuth2授权框架和OpenID Connect认证协议.html-X7F-E25z.js" as="script"><link rel="prefetch" href="/assets/SpringBoot基于Session实现身份认证与授权.html-Z7KuQmKQ.js" as="script"><link rel="prefetch" href="/assets/SpringSecurity实现OAuth 2.1和OpenID Connect 1.0认证与授权.html-R0esr90g.js" as="script"><link rel="prefetch" href="/assets/SpringSecurity实现传统单体应用的认证与授权.html-f9_JSzPk.js" as="script"><link rel="prefetch" href="/assets/SpringSecurity实现前后端分离应用的认证和授权.html-KCNCMQU0.js" as="script"><link rel="prefetch" href="/assets/ElasticSearch必知必会.html-8jlgnmBJ.js" as="script"><link rel="prefetch" href="/assets/ElasticStack环境搭建.html-NQPOOQjc.js" as="script"><link rel="prefetch" href="/assets/MinIO Java SDK.html-EBLvPI0P.js" as="script"><link rel="prefetch" href="/assets/MinIO JavaScript SDK.html-8D6xWxLe.js" as="script"><link rel="prefetch" href="/assets/MinIO安装与部署.html-H-0pY3ki.js" as="script"><link rel="prefetch" href="/assets/RabbitMQ安装与部署.html-1njIkJcg.js" as="script"><link rel="prefetch" href="/assets/RabbitMQ必知必会.html-7oWFg-jZ.js" as="script"><link rel="prefetch" href="/assets/Zookeeper必知必会.html-WO9uvwoe.js" as="script"><link rel="prefetch" href="/assets/Zookeeper环境搭建.html-DkEf0Mrk.js" as="script"><link rel="prefetch" href="/assets/index.html-ANe6i1C3.js" as="script"><link rel="prefetch" href="/assets/CSS层叠.html-OgLXMl7w.js" as="script"><link rel="prefetch" href="/assets/CSS布局.html-zp4J5xdy.js" as="script"><link rel="prefetch" href="/assets/CSS盒模型.html-8X4VTrHQ.js" as="script"><link rel="prefetch" href="/assets/CSS选择器.html-oBwWqqsQ.js" as="script"><link rel="prefetch" href="/assets/index.html-lwbpdwus.js" as="script"><link rel="prefetch" href="/assets/less入门.html-9CnTWHjf.js" as="script"><link rel="prefetch" href="/assets/sass入门.html-Ipw4zynu.js" as="script"><link rel="prefetch" href="/assets/index.html-IA_aNuRG.js" as="script"><link rel="prefetch" href="/assets/HTML与CSS实现鼠标悬浮显示图片.html-Ly_ezb-A.js" as="script"><link rel="prefetch" href="/assets/index.html-JaX1Qf5W.js" as="script"><link rel="prefetch" href="/assets/index.html-DMDJcw4T.js" as="script"><link rel="prefetch" href="/assets/index.html-xj8qxmRi.js" as="script"><link rel="prefetch" href="/assets/JavaScript事件模型.html-nn6PZAaL.js" as="script"><link rel="prefetch" href="/assets/JavaScript函数.html-1QkCztIZ.js" as="script"><link rel="prefetch" href="/assets/JavaScript对象.html-oXxsJnwC.js" as="script"><link rel="prefetch" href="/assets/JavaScript类.html-Q4yKhPxy.js" as="script"><link rel="prefetch" href="/assets/JavaScript继承与原型链.html-QzdZ9KmO.js" as="script"><link rel="prefetch" href="/assets/index.html-7uCyciav.js" as="script"><link rel="prefetch" href="/assets/index.html-wip4JIXy.js" as="script"><link rel="prefetch" href="/assets/node环境搭建.html-WdZG9CK3.js" as="script"><link rel="prefetch" href="/assets/npm.html-pBCFGJiW.js" as="script"><link rel="prefetch" href="/assets/yarn.html--JCBIf7W.js" as="script"><link rel="prefetch" href="/assets/index.html-2uzpPyho.js" as="script"><link rel="prefetch" href="/assets/axios.html-DwU8zG4j.js" as="script"><link rel="prefetch" href="/assets/element-plus.html-SI9RhiK1.js" as="script"><link rel="prefetch" href="/assets/element-ui.html-UKYikmnp.js" as="script"><link rel="prefetch" href="/assets/index.html-ogryD2lY.js" as="script"><link rel="prefetch" href="/assets/pinia.html-ywaPQOQm.js" as="script"><link rel="prefetch" href="/assets/vite.html-uNPMAALv.js" as="script"><link rel="prefetch" href="/assets/vue v2.html-Z3yGJlpO.js" as="script"><link rel="prefetch" href="/assets/vue v3.html-2odPUXvs.js" as="script"><link rel="prefetch" href="/assets/vue-cli.html-p-n4QqwW.js" as="script"><link rel="prefetch" href="/assets/vue-router v3.html-TEiWqjgb.js" as="script"><link rel="prefetch" href="/assets/vue-router v4.html-c5l77Tjm.js" as="script"><link rel="prefetch" href="/assets/vuex.html-VftARbzm.js" as="script"><link rel="prefetch" href="/assets/Vue项目结构最佳实践.html-rGEBIxv-.js" as="script"><link rel="prefetch" href="/assets/Canvas API.html-iNi5CvkV.js" as="script"><link rel="prefetch" href="/assets/Console API.html-hWLgp2-8.js" as="script"><link rel="prefetch" href="/assets/Fullscreen API.html-5-CpT_tH.js" as="script"><link rel="prefetch" href="/assets/History API.html-lIw5rcqi.js" as="script"><link rel="prefetch" href="/assets/HTML DOM API.html-_2CkmmAl.js" as="script"><link rel="prefetch" href="/assets/HTTP客户端API.html-IJLnsYUc.js" as="script"><link rel="prefetch" href="/assets/index.html-IM6CrK1p.js" as="script"><link rel="prefetch" href="/assets/Navigation API.html-YPGl56bK.js" as="script"><link rel="prefetch" href="/assets/客户端存储API.html-ARyc1zvb.js" as="script"><link rel="prefetch" href="/assets/文件操作API.html-TNI-9lA9.js" as="script"><link rel="prefetch" href="/assets/音频与视频API.html-digdOBU_.js" as="script"><link rel="prefetch" href="/assets/VuePress搭建静态站点.html-uCZXbZas.js" as="script"><link rel="prefetch" href="/assets/VuePress自定义主题.html-vuvQaKme.js" as="script"><link rel="prefetch" href="/assets/实现散列表数据结构.html-mRb1aaen.js" as="script"><link rel="prefetch" href="/assets/实现栈数据结构.html-5soryvbI.js" as="script"><link rel="prefetch" href="/assets/实现背包数据结构.html-7YjJGmhP.js" as="script"><link rel="prefetch" href="/assets/实现队列数据结构.html-Fd9tJrF6.js" as="script"><link rel="prefetch" href="/assets/最大公约数.html-Kr-xO0xN.js" as="script"><link rel="prefetch" href="/assets/基础排序算法.html-KdjJUfRX.js" as="script"><link rel="prefetch" href="/assets/中介者模式.html-3joz8KdP.js" as="script"><link rel="prefetch" href="/assets/命令模式.html-Hhmx8C8i.js" as="script"><link rel="prefetch" href="/assets/备忘录模式.html-nhOqWiJ9.js" as="script"><link rel="prefetch" href="/assets/模板方法模式.html-ImQq5R8W.js" as="script"><link rel="prefetch" href="/assets/状态模式.html-CWL4DdNU.js" as="script"><link rel="prefetch" href="/assets/策略模式.html-Yuct81O_.js" as="script"><link rel="prefetch" href="/assets/观察者模式.html-EJc12709.js" as="script"><link rel="prefetch" href="/assets/解释器模式.html-5FSjUD9J.js" as="script"><link rel="prefetch" href="/assets/访问者模式.html-MQ2DPLAG.js" as="script"><link rel="prefetch" href="/assets/责任链模式.html-OLl-b1vH.js" as="script"><link rel="prefetch" href="/assets/迭代器模式.html-nQ1dnA6H.js" as="script"><link rel="prefetch" href="/assets/单例模式.html-fayZrxvv.js" as="script"><link rel="prefetch" href="/assets/原型模式.html-bd1iU9g0.js" as="script"><link rel="prefetch" href="/assets/工厂方法模式.html--ODa2A9m.js" as="script"><link rel="prefetch" href="/assets/建造者模式.html-314GRRKg.js" as="script"><link rel="prefetch" href="/assets/抽象工厂模式.html-SUzZopEw.js" as="script"><link rel="prefetch" href="/assets/简单工厂模式.html-xia3zg_h.js" as="script"><link rel="prefetch" href="/assets/享元模式.html-mRRMugjf.js" as="script"><link rel="prefetch" href="/assets/代理模式.html-0zHM8sXD.js" as="script"><link rel="prefetch" href="/assets/外观模式.html-68AzHQSB.js" as="script"><link rel="prefetch" href="/assets/桥接模式.html-mKefklqo.js" as="script"><link rel="prefetch" href="/assets/组合模式.html-P2TGZ8bh.js" as="script"><link rel="prefetch" href="/assets/装饰器模式.html-dYuvMr5_.js" as="script"><link rel="prefetch" href="/assets/适配器模式.html-gL-gZmw2.js" as="script"><link rel="prefetch" href="/assets/Windows bat脚本编程.html-Edo0v6cO.js" as="script"><link rel="prefetch" href="/assets/Windows下的Android子系统.html-ATHrcsCu.js" as="script"><link rel="prefetch" href="/assets/Windows下的Linux子系统.html-_D1PP0AR.js" as="script"><link rel="prefetch" href="/assets/Windows命令.html-9qBPdCZi.js" as="script"><link rel="prefetch" href="/assets/创建项目.html-dIqhu3XC.js" as="script"><link rel="prefetch" href="/assets/商品微服务开发.html-_1yfChqA.js" as="script"><link rel="prefetch" href="/assets/数据库表设计.html-ac8ybxe1.js" as="script"><link rel="prefetch" href="/assets/环境搭建.html-xew9uPgH.js" as="script"><link rel="prefetch" href="/assets/订单微服务开发.html-lRh5tkYd.js" as="script"><link rel="prefetch" href="/assets/JavaFX快速开始.html-Mixm2vb8.js" as="script"><link rel="prefetch" href="/assets/Java创建线程.html-7KvrsL7G.js" as="script"><link rel="prefetch" href="/assets/Java并发编程辅助工具.html-m93pbpwt.js" as="script"><link rel="prefetch" href="/assets/Java线程属性与基本操作.html-ldIb6mVz.js" as="script"><link rel="prefetch" href="/assets/Java线程锁.html-A-Quj_Y6.js" as="script"><link rel="prefetch" href="/assets/Java操作SQL数据库.html-PdhFhHX9.js" as="script"><link rel="prefetch" href="/assets/Java处理CSV数据.html-Zks-5-Cr.js" as="script"><link rel="prefetch" href="/assets/Java处理JSON数据.html-YS4QbeS8.js" as="script"><link rel="prefetch" href="/assets/Java处理Properties数据.html-tmzACDhL.js" as="script"><link rel="prefetch" href="/assets/Java处理XML数据.html-0Fz9tCG5.js" as="script"><link rel="prefetch" href="/assets/Java处理YAML数据.html-PccR-YMQ.js" as="script"><link rel="prefetch" href="/assets/Java内存模型.html-3dMMmsMC.js" as="script"><link rel="prefetch" href="/assets/Java垃圾回收机制.html-Wssdkjl0.js" as="script"><link rel="prefetch" href="/assets/Java类加载机制.html-UhssbphX.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成AMQP消息中间件.html-azDHfNxi.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成ElasticSearch.html-Jwip58BM.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成FreeMarker模板引擎.html-rv8gaBkK.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成jdbc.html-nJd3IKQx.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成jpa.html-05xkZ9-u.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成MongoDB.html-WCTEKkCe.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成MyBatis.html-GIxU2ZTD.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成MyBatisPlus.html-ouEwQn7A.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成Redis.html-MSBCKJUj.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成RestTemplate.html-braUXT3g.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成Swagger.html-6HgeNQS5.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成Thymeleaf模板引擎.html-WtnGehah.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成WebService.html-eYy3FemZ.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成WebSocket.html-XP5L7AEx.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成邮件服务.html-b3vdscjN.js" as="script"><link rel="prefetch" href="/assets/404.html-uYdQglAC.js" as="script"><link rel="prefetch" href="/assets/index.html-JSvV4-Il.js" as="script"><link rel="prefetch" href="/assets/index.html-Jo7smpNt.js" as="script"><link rel="prefetch" href="/assets/index.html-rd5tg_Zy.js" as="script"><link rel="prefetch" href="/assets/index.html-40bnXLgu.js" as="script"><link rel="prefetch" href="/assets/index.html-zCVX1Fek.js" as="script"><link rel="prefetch" href="/assets/index.html-0H5yXPFN.js" as="script"><link rel="prefetch" href="/assets/项目A.html-c3ulFlY5.js" as="script"><link rel="prefetch" href="/assets/index.html-x5NhYY_O.js" as="script"><link rel="prefetch" href="/assets/早起的一天.html-8Z0ltJ20.js" as="script"><link rel="prefetch" href="/assets/index.html-miVjArKi.js" as="script"><link rel="prefetch" href="/assets/index.html-gm9qCSWV.js" as="script"><link rel="prefetch" href="/assets/charlse.html-Br9ACOZW.js" as="script"><link rel="prefetch" href="/assets/docker入门.html-9v8V-bWB.js" as="script"><link rel="prefetch" href="/assets/docker环境搭建.html-BBHv-VTM.js" as="script"><link rel="prefetch" href="/assets/fidller.html-ICIMv2bJ.js" as="script"><link rel="prefetch" href="/assets/github入门.html-yU-LOwIj.js" as="script"><link rel="prefetch" href="/assets/git入门.html-cIL07jw7.js" as="script"><link rel="prefetch" href="/assets/gradle入门.html-oxQDZ7bh.js" as="script"><link rel="prefetch" href="/assets/index.html-5aFYDetf.js" as="script"><link rel="prefetch" href="/assets/Intelij IDEA.html-hReg-lM0.js" as="script"><link rel="prefetch" href="/assets/maven入门.html-VuraySOD.js" as="script"><link rel="prefetch" href="/assets/navicat.html-91lBavJg.js" as="script"><link rel="prefetch" href="/assets/postman.html-5YGwnncb.js" as="script"><link rel="prefetch" href="/assets/svn入门.html-23lReQ9n.js" as="script"><link rel="prefetch" href="/assets/uml.html-rcsvS6X-.js" as="script"><link rel="prefetch" href="/assets/VirtualBox.html-R6-CVLyu.js" as="script"><link rel="prefetch" href="/assets/vmware.html-IPXdAunx.js" as="script"><link rel="prefetch" href="/assets/vscode.html-5v9T2UUs.js" as="script"><link rel="prefetch" href="/assets/WinSCP.html-ZXVLRatL.js" as="script"><link rel="prefetch" href="/assets/wireshark.html-srUdc23-.js" as="script"><link rel="prefetch" href="/assets/XShell.html-tqLhDFHN.js" as="script"><link rel="prefetch" href="/assets/index.html-EuuEnG9W.js" as="script"><link rel="prefetch" href="/assets/VPN搭建.html-knhOd1Pg.js" as="script"><link rel="prefetch" href="/assets/index.html-CQgkW18W.js" as="script"><link rel="prefetch" href="/assets/minecraft开发环境搭建.html-YuyDwIPQ.js" as="script"><link rel="prefetch" href="/assets/index.html-HnjIQxTj.js" as="script"><link rel="prefetch" href="/assets/index.html-gRDnmehO.js" as="script"><link rel="prefetch" href="/assets/index.html-rvdBfvk6.js" as="script"><link rel="prefetch" href="/assets/index.html-7UbtpfsR.js" as="script"><link rel="prefetch" href="/assets/index.html-bzZrK203.js" as="script"><link rel="prefetch" href="/assets/axure.html-mmZSPeVv.js" as="script"><link rel="prefetch" href="/assets/index.html-dihV-hy7.js" as="script"><link rel="prefetch" href="/assets/MinIO Typora PicGo搭建个人图床服务.html-M06ax7YW.js" as="script"><link rel="prefetch" href="/assets/typora.html-ztn6GGiw.js" as="script"><link rel="prefetch" href="/assets/index.html-nQfVCnT2.js" as="script"><link rel="prefetch" href="/assets/index.html-WWAgz8Yn.js" as="script"><link rel="prefetch" href="/assets/index.html-zBn8lf0P.js" as="script"><link rel="prefetch" href="/assets/index.html-6IjXgk1m.js" as="script"><link rel="prefetch" href="/assets/index.html-z-G8yUU8.js" as="script"><link rel="prefetch" href="/assets/在线商城系统表设计.html-RPXQZPQq.js" as="script"><link rel="prefetch" href="/assets/权限管理系统设计.html-AsIdgYVV.js" as="script"><link rel="prefetch" href="/assets/index.html-TLTJSerz.js" as="script"><link rel="prefetch" href="/assets/浏览器跨域.html-9V76Oeha.js" as="script"><link rel="prefetch" href="/assets/index.html-bVHeJjXv.js" as="script"><link rel="prefetch" href="/assets/MongoDB安装.html-OSZSCk9V.js" as="script"><link rel="prefetch" href="/assets/mysql事务.html-EPII67Xc.js" as="script"><link rel="prefetch" href="/assets/MySQL安装.html-EL_Vv_LV.js" as="script"><link rel="prefetch" href="/assets/mysql索引.html-nq8w0dpt.js" as="script"><link rel="prefetch" href="/assets/mysql集群.html-ZNok4wE0.js" as="script"><link rel="prefetch" href="/assets/PostgreSQL函数.html-NMd9ajtZ.js" as="script"><link rel="prefetch" href="/assets/PostgreSQL安装.html-9oXfho7f.js" as="script"><link rel="prefetch" href="/assets/Redis客户端.html-JPhK_BVP.js" as="script"><link rel="prefetch" href="/assets/Redis应用场景.html-O-DSaQPC.js" as="script"><link rel="prefetch" href="/assets/Redis数据结构.html-hQ4Jeo4M.js" as="script"><link rel="prefetch" href="/assets/Redis环境搭建.html-ne3XTIII.js" as="script"><link rel="prefetch" href="/assets/Redis高可用机制.html-6oEuhCe2.js" as="script"><link rel="prefetch" href="/assets/Redis高级特性.html-YJzRBjzJ.js" as="script"><link rel="prefetch" href="/assets/sql增删改.html-W19-NEpw.js" as="script"><link rel="prefetch" href="/assets/sql数据库和表.html-NtEv9yxk.js" as="script"><link rel="prefetch" href="/assets/sql查询.html-vz-aoKGI.js" as="script"><link rel="prefetch" href="/assets/sql经典实例.html-1rIpqO5D.js" as="script"><link rel="prefetch" href="/assets/index.html-PDd-6fkt.js" as="script"><link rel="prefetch" href="/assets/index.html-NkgRiHeL.js" as="script"><link rel="prefetch" href="/assets/index.html-sLzdHosV.js" as="script"><link rel="prefetch" href="/assets/JSP.html-HD5nY9Ml.js" as="script"><link rel="prefetch" href="/assets/Servlet.html-O5eiC-qx.js" as="script"><link rel="prefetch" href="/assets/Tomcat.html-2pqHAg6d.js" as="script"><link rel="prefetch" href="/assets/index.html-zXqUiu3w.js" as="script"><link rel="prefetch" href="/assets/index.html-R7d4XlnR.js" as="script"><link rel="prefetch" href="/assets/mybatis动态SQL.html-W9j0G3HR.js" as="script"><link rel="prefetch" href="/assets/mybatis增删改查.html-yiEPu3z6.js" as="script"><link rel="prefetch" href="/assets/mybatis快速开始.html-Mwcf9GIh.js" as="script"><link rel="prefetch" href="/assets/mybatis插件.html-bu_RDPux.js" as="script"><link rel="prefetch" href="/assets/mybatis配置.html-WzLyUybt.js" as="script"><link rel="prefetch" href="/assets/index.html-ms5H8MIE.js" as="script"><link rel="prefetch" href="/assets/index.html-R_akDp4a.js" as="script"><link rel="prefetch" href="/assets/Java代理.html-FJvV55fr.js" as="script"><link rel="prefetch" href="/assets/Java反射.html-v6hQSekX.js" as="script"><link rel="prefetch" href="/assets/Java文件与流.html-7j1LuCtq.js" as="script"><link rel="prefetch" href="/assets/Java新特性总结.html-8pNcvUdJ.js" as="script"><link rel="prefetch" href="/assets/Java正则表达式.html-q0TmD2gX.js" as="script"><link rel="prefetch" href="/assets/Java泛型.html-8O7--5ds.js" as="script"><link rel="prefetch" href="/assets/Java注解.html-hjKbkjXH.js" as="script"><link rel="prefetch" href="/assets/Java集合.html-4FbW6ggj.js" as="script"><link rel="prefetch" href="/assets/Java面向对象编程核心思想.html-MFWZgmuE.js" as="script"><link rel="prefetch" href="/assets/index.html-r8oFRFtV.js" as="script"><link rel="prefetch" href="/assets/index.html-3SDodp3G.js" as="script"><link rel="prefetch" href="/assets/SpringBoot使用事务.html-liZtDH-q.js" as="script"><link rel="prefetch" href="/assets/SpringBoot使用定时任务.html-rLyJKz23.js" as="script"><link rel="prefetch" href="/assets/SpringBoot使用异步任务.html-H8IZtdqd.js" as="script"><link rel="prefetch" href="/assets/SpringBoot使用拦截器.html-7WemCdgh.js" as="script"><link rel="prefetch" href="/assets/SpringBoot单元测试.html-8fJr-GHG.js" as="script"><link rel="prefetch" href="/assets/SpringBoot参数校验.html-vBQ_PUa6.js" as="script"><link rel="prefetch" href="/assets/SpringBoot国际化支持.html-ox_O6bwQ.js" as="script"><link rel="prefetch" href="/assets/SpringBoot处理JSON数据.html-HACR9uOz.js" as="script"><link rel="prefetch" href="/assets/SpringBoot快速开始.html-y8q0LzJl.js" as="script"><link rel="prefetch" href="/assets/SpringBoot日志.html-adrab0og.js" as="script"><link rel="prefetch" href="/assets/SpringBoot核心特性-Actuator.html-wfMLT8zV.js" as="script"><link rel="prefetch" href="/assets/SpringBoot核心特性-CLI.html-H_dF0Ht3.js" as="script"><link rel="prefetch" href="/assets/SpringBoot核心特性-devtools.html-QIWUOkOB.js" as="script"><link rel="prefetch" href="/assets/SpringBoot核心特性-SpringApplication类.html-9ZkvxtHi.js" as="script"><link rel="prefetch" href="/assets/SpringBoot核心特性-starter启动器.html-Akt4M9SI.js" as="script"><link rel="prefetch" href="/assets/SpringBoot核心特性-外部化配置.html-PDRmtg4y.js" as="script"><link rel="prefetch" href="/assets/SpringBoot核心特性-嵌入式WebServer.html-zQrbMukh.js" as="script"><link rel="prefetch" href="/assets/SpringBoot核心特性-自动配置.html-Ho0A34sh.js" as="script"><link rel="prefetch" href="/assets/SpringBoot统一处理响应.html-JQ_0TSV8.js" as="script"><link rel="prefetch" href="/assets/index.html-ZzHvVViz.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Alibaba Nacos注册中心.html-R3ite5Du.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Alibaba Nacos部署.html-wWS7uEya.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Alibaba Nacos配置中心.html-0wWqiTV-.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Alibaba Seata分布式事务.html-23BRTbIJ.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Alibaba Sentinel断路器.html-AdAU3th8.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Bus消息总线.html-V4lxv4yF.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud CircuitBreaker断路器.html-04YAAaMj.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Config配置中心.html-UMlvpTpU.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Consul注册中心.html-Uix9G1ak.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Consul配置中心.html-5JlWDc8Q.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Gateway API网关.html-j4RHd4hz.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Netflix Eureka注册中心.html-q68q9u50.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Netflix Hystrix断路器.html-6e14f4Lc.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Netflix Zuul API网关.html-71y3-Ob-.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Sleuth链路跟踪.html-e0dpautY.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Stream消息驱动.html-kX-4O6JW.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Zookeeper注册中心.html-ARdeKldY.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud Zookeeper配置中心.html-cm_-yk3j.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud服务调用与客户端负载均衡.html-YE7M4NIr.js" as="script"><link rel="prefetch" href="/assets/Spring Cloud项目环境搭建.html-IqhpUX4W.js" as="script"><link rel="prefetch" href="/assets/分布式系统中全局唯一ID实现方案.html-TdsZz8VT.js" as="script"><link rel="prefetch" href="/assets/微服务理论知识.html-veNADwU2.js" as="script"><link rel="prefetch" href="/assets/index.html-fuoR_vfW.js" as="script"><link rel="prefetch" href="/assets/Spring AOP编程.html-kBZZ10cZ.js" as="script"><link rel="prefetch" href="/assets/Spring IoC容器.html-1RGDL9Du.js" as="script"><link rel="prefetch" href="/assets/Spring MVC.html-UBM5KAe1.js" as="script"><link rel="prefetch" href="/assets/Spring快速开始.html-Zw8LErYf.js" as="script"><link rel="prefetch" href="/assets/Spring表达式语言SpEL.html-tbC1hqIe.js" as="script"><link rel="prefetch" href="/assets/index.html-Su8yAb4-.js" as="script"><link rel="prefetch" href="/assets/OAuth2授权框架和OpenID Connect认证协议.html-wvbYWiVp.js" as="script"><link rel="prefetch" href="/assets/SpringBoot基于Session实现身份认证与授权.html-qTHfkVXo.js" as="script"><link rel="prefetch" href="/assets/SpringSecurity实现OAuth 2.1和OpenID Connect 1.0认证与授权.html-ECHAfKh-.js" as="script"><link rel="prefetch" href="/assets/SpringSecurity实现传统单体应用的认证与授权.html-SffRcWlk.js" as="script"><link rel="prefetch" href="/assets/SpringSecurity实现前后端分离应用的认证和授权.html-BmgXGUEV.js" as="script"><link rel="prefetch" href="/assets/ElasticSearch必知必会.html-1lJVRQ5f.js" as="script"><link rel="prefetch" href="/assets/ElasticStack环境搭建.html-Z_kujurL.js" as="script"><link rel="prefetch" href="/assets/MinIO Java SDK.html-RXhGr3AJ.js" as="script"><link rel="prefetch" href="/assets/MinIO JavaScript SDK.html-HKSaPVgq.js" as="script"><link rel="prefetch" href="/assets/MinIO安装与部署.html-j7t6HOpa.js" as="script"><link rel="prefetch" href="/assets/RabbitMQ安装与部署.html-i4BQ8AaF.js" as="script"><link rel="prefetch" href="/assets/RabbitMQ必知必会.html-LRHW_MhK.js" as="script"><link rel="prefetch" href="/assets/Zookeeper必知必会.html-h-KUp1BL.js" as="script"><link rel="prefetch" href="/assets/Zookeeper环境搭建.html-ruEcqQ8B.js" as="script"><link rel="prefetch" href="/assets/index.html-G2d0VRPE.js" as="script"><link rel="prefetch" href="/assets/CSS层叠.html-beCyNXBX.js" as="script"><link rel="prefetch" href="/assets/CSS布局.html-bEUNLQZQ.js" as="script"><link rel="prefetch" href="/assets/CSS盒模型.html-Fq2mODob.js" as="script"><link rel="prefetch" href="/assets/CSS选择器.html-nMIGeXmE.js" as="script"><link rel="prefetch" href="/assets/index.html-P9OcXO24.js" as="script"><link rel="prefetch" href="/assets/less入门.html-VavalLK7.js" as="script"><link rel="prefetch" href="/assets/sass入门.html-4TnciKL_.js" as="script"><link rel="prefetch" href="/assets/index.html-zwEX8PMX.js" as="script"><link rel="prefetch" href="/assets/HTML与CSS实现鼠标悬浮显示图片.html-sQ-XofF3.js" as="script"><link rel="prefetch" href="/assets/index.html-fcZLEKAy.js" as="script"><link rel="prefetch" href="/assets/index.html-G87d3ev8.js" as="script"><link rel="prefetch" href="/assets/index.html-F_aalPJo.js" as="script"><link rel="prefetch" href="/assets/JavaScript事件模型.html-htDgnKQ-.js" as="script"><link rel="prefetch" href="/assets/JavaScript函数.html-E08sXO6T.js" as="script"><link rel="prefetch" href="/assets/JavaScript对象.html-ueohqyRM.js" as="script"><link rel="prefetch" href="/assets/JavaScript类.html-cPPzo3A0.js" as="script"><link rel="prefetch" href="/assets/JavaScript继承与原型链.html-1X5P0Zjg.js" as="script"><link rel="prefetch" href="/assets/index.html-kXqX0nEI.js" as="script"><link rel="prefetch" href="/assets/index.html-C8nrbY1O.js" as="script"><link rel="prefetch" href="/assets/node环境搭建.html-PYidwBW0.js" as="script"><link rel="prefetch" href="/assets/npm.html-q-8fGIOS.js" as="script"><link rel="prefetch" href="/assets/yarn.html-eemLwTn5.js" as="script"><link rel="prefetch" href="/assets/index.html-1lhphIif.js" as="script"><link rel="prefetch" href="/assets/axios.html-599RLDuD.js" as="script"><link rel="prefetch" href="/assets/element-plus.html-hblWD4ul.js" as="script"><link rel="prefetch" href="/assets/element-ui.html-3ZgX7v-c.js" as="script"><link rel="prefetch" href="/assets/index.html-kgzn0IRI.js" as="script"><link rel="prefetch" href="/assets/pinia.html-N5Sbknbi.js" as="script"><link rel="prefetch" href="/assets/vite.html-I1nf1v46.js" as="script"><link rel="prefetch" href="/assets/vue v2.html-mldOK9gr.js" as="script"><link rel="prefetch" href="/assets/vue v3.html-5hFZBIM5.js" as="script"><link rel="prefetch" href="/assets/vue-cli.html-FWD7j5Ya.js" as="script"><link rel="prefetch" href="/assets/vue-router v3.html-MWG0JLOD.js" as="script"><link rel="prefetch" href="/assets/vue-router v4.html-TKIMBwI1.js" as="script"><link rel="prefetch" href="/assets/vuex.html-bn2QJFQC.js" as="script"><link rel="prefetch" href="/assets/Vue项目结构最佳实践.html-pm0NLCDd.js" as="script"><link rel="prefetch" href="/assets/Canvas API.html-NWzb2gzP.js" as="script"><link rel="prefetch" href="/assets/Console API.html-GG1FGY1j.js" as="script"><link rel="prefetch" href="/assets/Fullscreen API.html-INalvpsU.js" as="script"><link rel="prefetch" href="/assets/History API.html-3m_IG9nR.js" as="script"><link rel="prefetch" href="/assets/HTML DOM API.html-GPdUrTxo.js" as="script"><link rel="prefetch" href="/assets/HTTP客户端API.html-ihASbgw_.js" as="script"><link rel="prefetch" href="/assets/index.html-P-zPsVCe.js" as="script"><link rel="prefetch" href="/assets/Navigation API.html-7hOdvwNx.js" as="script"><link rel="prefetch" href="/assets/客户端存储API.html-dAwmzq2s.js" as="script"><link rel="prefetch" href="/assets/文件操作API.html-rrN-RUko.js" as="script"><link rel="prefetch" href="/assets/音频与视频API.html-Y5PJslej.js" as="script"><link rel="prefetch" href="/assets/VuePress搭建静态站点.html-Rs-oX6CD.js" as="script"><link rel="prefetch" href="/assets/VuePress自定义主题.html-vrse38P2.js" as="script"><link rel="prefetch" href="/assets/实现散列表数据结构.html-S13Yz2YE.js" as="script"><link rel="prefetch" href="/assets/实现栈数据结构.html-NxY3xxmN.js" as="script"><link rel="prefetch" href="/assets/实现背包数据结构.html-QRFOQO6x.js" as="script"><link rel="prefetch" href="/assets/实现队列数据结构.html-vKxkDZ2H.js" as="script"><link rel="prefetch" href="/assets/最大公约数.html-HBWsIOSj.js" as="script"><link rel="prefetch" href="/assets/基础排序算法.html-iA0dCjyF.js" as="script"><link rel="prefetch" href="/assets/中介者模式.html-2BHqicrP.js" as="script"><link rel="prefetch" href="/assets/命令模式.html-KrLLbBna.js" as="script"><link rel="prefetch" href="/assets/备忘录模式.html-HIBIi-j0.js" as="script"><link rel="prefetch" href="/assets/模板方法模式.html-YdWsgnOS.js" as="script"><link rel="prefetch" href="/assets/状态模式.html-VzVqe9xs.js" as="script"><link rel="prefetch" href="/assets/策略模式.html-yFAsD7B9.js" as="script"><link rel="prefetch" href="/assets/观察者模式.html---NV3rzr.js" as="script"><link rel="prefetch" href="/assets/解释器模式.html-JEfJs3en.js" as="script"><link rel="prefetch" href="/assets/访问者模式.html-g5bM9dF7.js" as="script"><link rel="prefetch" href="/assets/责任链模式.html-A8P0XxXe.js" as="script"><link rel="prefetch" href="/assets/迭代器模式.html-w3shsrqR.js" as="script"><link rel="prefetch" href="/assets/单例模式.html-17xiulpy.js" as="script"><link rel="prefetch" href="/assets/原型模式.html-mk7Rle4m.js" as="script"><link rel="prefetch" href="/assets/工厂方法模式.html-usO3guNi.js" as="script"><link rel="prefetch" href="/assets/建造者模式.html-xbJXuZBR.js" as="script"><link rel="prefetch" href="/assets/抽象工厂模式.html--4WvLmjF.js" as="script"><link rel="prefetch" href="/assets/简单工厂模式.html-jmF9loRY.js" as="script"><link rel="prefetch" href="/assets/享元模式.html-5OdCcPoU.js" as="script"><link rel="prefetch" href="/assets/代理模式.html-UvCVSkoV.js" as="script"><link rel="prefetch" href="/assets/外观模式.html-5vib-1t1.js" as="script"><link rel="prefetch" href="/assets/桥接模式.html-hyeNNoEv.js" as="script"><link rel="prefetch" href="/assets/组合模式.html-BNoSSUCY.js" as="script"><link rel="prefetch" href="/assets/装饰器模式.html-KLnpOA6K.js" as="script"><link rel="prefetch" href="/assets/适配器模式.html-4cC3-4p0.js" as="script"><link rel="prefetch" href="/assets/Windows bat脚本编程.html-dcK6dr8l.js" as="script"><link rel="prefetch" href="/assets/Windows下的Android子系统.html-n7XTBGSY.js" as="script"><link rel="prefetch" href="/assets/Windows下的Linux子系统.html-aUHtEZZ_.js" as="script"><link rel="prefetch" href="/assets/Windows命令.html-1oQMIHqb.js" as="script"><link rel="prefetch" href="/assets/创建项目.html-sDTbpzWC.js" as="script"><link rel="prefetch" href="/assets/商品微服务开发.html-w60uKq3d.js" as="script"><link rel="prefetch" href="/assets/数据库表设计.html-AYdKVK7x.js" as="script"><link rel="prefetch" href="/assets/环境搭建.html-dI59TQce.js" as="script"><link rel="prefetch" href="/assets/订单微服务开发.html-q-a2CNo0.js" as="script"><link rel="prefetch" href="/assets/JavaFX快速开始.html-E-2ESLus.js" as="script"><link rel="prefetch" href="/assets/Java创建线程.html-39sGWjcM.js" as="script"><link rel="prefetch" href="/assets/Java并发编程辅助工具.html-_8TTVz-6.js" as="script"><link rel="prefetch" href="/assets/Java线程属性与基本操作.html-Bxp3mqIp.js" as="script"><link rel="prefetch" href="/assets/Java线程锁.html-_s3y_qZh.js" as="script"><link rel="prefetch" href="/assets/Java操作SQL数据库.html-Uc24huXJ.js" as="script"><link rel="prefetch" href="/assets/Java处理CSV数据.html-E188jvpz.js" as="script"><link rel="prefetch" href="/assets/Java处理JSON数据.html-ptukXs2q.js" as="script"><link rel="prefetch" href="/assets/Java处理Properties数据.html-1sqx3oHK.js" as="script"><link rel="prefetch" href="/assets/Java处理XML数据.html-RMMoj-7e.js" as="script"><link rel="prefetch" href="/assets/Java处理YAML数据.html-LjtqxAfU.js" as="script"><link rel="prefetch" href="/assets/Java内存模型.html-1roBUxHR.js" as="script"><link rel="prefetch" href="/assets/Java垃圾回收机制.html-J7od0MuV.js" as="script"><link rel="prefetch" href="/assets/Java类加载机制.html-4qy3l7U1.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成AMQP消息中间件.html-Yqx_dzRs.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成ElasticSearch.html-UQ3MQM8i.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成FreeMarker模板引擎.html-lved4TJm.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成jdbc.html-r0BGm5Wy.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成jpa.html-dLOpV-Pj.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成MongoDB.html-7f5asozr.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成MyBatis.html-S2WUekrz.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成MyBatisPlus.html-SxaiRPo_.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成Redis.html-6FrRWDav.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成RestTemplate.html-b1-2-nSc.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成Swagger.html-dqbDdJys.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成Thymeleaf模板引擎.html-4WfvRX9s.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成WebService.html-Q13wS2Lr.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成WebSocket.html-BZx4vo0l.js" as="script"><link rel="prefetch" href="/assets/SpringBoot集成邮件服务.html-LgsnZly1.js" as="script"><link rel="prefetch" href="/assets/404.html-8YeapgZG.js" as="script"><link rel="prefetch" href="/assets/style-w40geAFS.js" as="script"><link rel="prefetch" href="/assets/docsearch-w40geAFS.js" as="script"><link rel="prefetch" href="/assets/index-QOy62Fup.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/logo.gif" alt="Bitbitpulse"><span class="site-name can-hide" aria-hidden="true">Bitbitpulse</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide" aria-label="site navigation"><!--[--><div class="navbar-item"><a href="/bookmarks/" class="" aria-label="收藏夹"><!--[--><!--]--> 收藏夹 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/bitbitpulse" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><!----><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items" aria-label="site navigation"><!--[--><div class="navbar-item"><a href="/bookmarks/" class="" aria-label="收藏夹"><!--[--><!--]--> 收藏夹 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/bitbitpulse" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">SpringSecurity实现前后端分离应用的认证与授权 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#准备工作" class="router-link-active router-link-exact-active sidebar-item" aria-label="准备工作"><!--[--><!--]--> 准备工作 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#创建springsecurity配置类" class="router-link-active router-link-exact-active sidebar-item" aria-label="创建SpringSecurity配置类"><!--[--><!--]--> 创建SpringSecurity配置类 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#自定义登录认证逻辑" class="router-link-active router-link-exact-active sidebar-item" aria-label="自定义登录认证逻辑"><!--[--><!--]--> 自定义登录认证逻辑 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#定义-authentication" class="router-link-active router-link-exact-active sidebar-item" aria-label="定义 Authentication"><!--[--><!--]--> 定义 Authentication <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#定义登录认证-filter" class="router-link-active router-link-exact-active sidebar-item" aria-label="定义登录认证 Filter"><!--[--><!--]--> 定义登录认证 Filter <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#定义-authenticationprovider" class="router-link-active router-link-exact-active sidebar-item" aria-label="定义 AuthenticationProvider"><!--[--><!--]--> 定义 AuthenticationProvider <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#定义认证成功-失败处理器" class="router-link-active router-link-exact-active sidebar-item" aria-label="定义认证成功/失败处理器"><!--[--><!--]--> 定义认证成功/失败处理器 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#配置认证信息" class="router-link-active router-link-exact-active sidebar-item" aria-label="配置认证信息"><!--[--><!--]--> 配置认证信息 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#测试" class="router-link-active router-link-exact-active sidebar-item" aria-label="测试"><!--[--><!--]--> 测试 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#密码加密" class="router-link-active router-link-exact-active sidebar-item" aria-label="密码加密"><!--[--><!--]--> 密码加密 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#自定义认证数据源" class="router-link-active router-link-exact-active sidebar-item" aria-label="自定义认证数据源"><!--[--><!--]--> 自定义认证数据源 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#准备工作-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="准备工作"><!--[--><!--]--> 准备工作 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#定义-userdetails" class="router-link-active router-link-exact-active sidebar-item" aria-label="定义 UserDetails"><!--[--><!--]--> 定义 UserDetails <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#定义-userdetailsservice" class="router-link-active router-link-exact-active sidebar-item" aria-label="定义 UserDetailsService"><!--[--><!--]--> 定义 UserDetailsService <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#配置" class="router-link-active router-link-exact-active sidebar-item" aria-label="配置"><!--[--><!--]--> 配置 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#通过多条filter链支持多用户表认证" class="router-link-active router-link-exact-active sidebar-item" aria-label="通过多条Filter链支持多用户表认证"><!--[--><!--]--> 通过多条Filter链支持多用户表认证 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#准备工作-2" class="router-link-active router-link-exact-active sidebar-item" aria-label="准备工作"><!--[--><!--]--> 准备工作 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#定义-userdetails-和-userdetailsservice-的实现类" class="router-link-active router-link-exact-active sidebar-item" aria-label="定义 UserDetails 和 UserDetailsService 的实现类"><!--[--><!--]--> 定义 UserDetails 和 UserDetailsService 的实现类 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#定义-authentication-filter-authenticationprovider-的实现类" class="router-link-active router-link-exact-active sidebar-item" aria-label="定义 Authentication，Filter，AuthenticationProvider 的实现类"><!--[--><!--]--> 定义 Authentication，Filter，AuthenticationProvider 的实现类 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#配置多个-authenticationmanager-bean和多条filter链" class="router-link-active router-link-exact-active sidebar-item" aria-label="配置多个  AuthenticationManager Bean和多条Filter链"><!--[--><!--]--> 配置多个  AuthenticationManager Bean和多条Filter链 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#测试-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="测试"><!--[--><!--]--> 测试 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#实现jwt认证" class="router-link-active router-link-exact-active sidebar-item" aria-label="实现JWT认证"><!--[--><!--]--> 实现JWT认证 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#添加jwt依赖" class="router-link-active router-link-exact-active sidebar-item" aria-label="添加jwt依赖"><!--[--><!--]--> 添加jwt依赖 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#封装jwt工具类" class="router-link-active router-link-exact-active sidebar-item" aria-label="封装jwt工具类"><!--[--><!--]--> 封装jwt工具类 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#登录成功后生成并返回jwt令牌" class="router-link-active router-link-exact-active sidebar-item" aria-label="登录成功后生成并返回jwt令牌"><!--[--><!--]--> 登录成功后生成并返回jwt令牌 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#使用filter验证请求中的jwt令牌" class="router-link-active router-link-exact-active sidebar-item" aria-label="使用Filter验证请求中的jwt令牌"><!--[--><!--]--> 使用Filter验证请求中的jwt令牌 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#配置-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="配置"><!--[--><!--]--> 配置 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#测试-2" class="router-link-active router-link-exact-active sidebar-item" aria-label="测试"><!--[--><!--]--> 测试 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#刷新jwt令牌" class="router-link-active router-link-exact-active sidebar-item" aria-label="刷新jwt令牌"><!--[--><!--]--> 刷新jwt令牌 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#在jwt工具类中添加生成访问令牌和刷新令牌的方法" class="router-link-active router-link-exact-active sidebar-item" aria-label="在JWT工具类中添加生成访问令牌和刷新令牌的方法"><!--[--><!--]--> 在JWT工具类中添加生成访问令牌和刷新令牌的方法 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#在登录成功处理器中-同时生成访问令牌和刷新令牌-并返回给客户端" class="router-link-active router-link-exact-active sidebar-item" aria-label="在登录成功处理器中，同时生成访问令牌和刷新令牌，并返回给客户端"><!--[--><!--]--> 在登录成功处理器中，同时生成访问令牌和刷新令牌，并返回给客户端 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#定义filter-拦截刷新令牌的请求-验证刷新令牌并重新颁发访问令牌和刷新令牌" class="router-link-active router-link-exact-active sidebar-item" aria-label="定义Filter，拦截刷新令牌的请求，验证刷新令牌并重新颁发访问令牌和刷新令牌"><!--[--><!--]--> 定义Filter，拦截刷新令牌的请求，验证刷新令牌并重新颁发访问令牌和刷新令牌 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#在springsecurity过滤器链中-放行刷新令牌的url" class="router-link-active router-link-exact-active sidebar-item" aria-label="在SpringSecurity过滤器链中，放行刷新令牌的URL"><!--[--><!--]--> 在SpringSecurity过滤器链中，放行刷新令牌的URL <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#测试-3" class="router-link-active router-link-exact-active sidebar-item" aria-label="测试"><!--[--><!--]--> 测试 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#实现remember-me认证" class="router-link-active router-link-exact-active sidebar-item" aria-label="实现Remember-me认证"><!--[--><!--]--> 实现Remember-me认证 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#基于哈希简单令牌实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="基于哈希简单令牌实现"><!--[--><!--]--> 基于哈希简单令牌实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#持久化令牌实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="持久化令牌实现"><!--[--><!--]--> 持久化令牌实现 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#实现注销登录" class="router-link-active router-link-exact-active sidebar-item" aria-label="实现注销登录"><!--[--><!--]--> 实现注销登录 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#定义注销成功处理器" class="router-link-active router-link-exact-active sidebar-item" aria-label="定义注销成功处理器"><!--[--><!--]--> 定义注销成功处理器 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#配置-2" class="router-link-active router-link-exact-active sidebar-item" aria-label="配置"><!--[--><!--]--> 配置 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#实现强制用户下线" class="router-link-active router-link-exact-active sidebar-item" aria-label="实现强制用户下线"><!--[--><!--]--> 实现强制用户下线 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#授权" class="router-link-active router-link-exact-active sidebar-item" aria-label="授权"><!--[--><!--]--> 授权 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#http请求级别的权限控制" class="router-link-active router-link-exact-active sidebar-item" aria-label="HTTP请求级别的权限控制"><!--[--><!--]--> HTTP请求级别的权限控制 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#方法级别的权限控制" class="router-link-active router-link-exact-active sidebar-item" aria-label="方法级别的权限控制"><!--[--><!--]--> 方法级别的权限控制 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#自定义-authorizationmanager-实现动态权限控制" class="router-link-active router-link-exact-active sidebar-item" aria-label="自定义 AuthorizationManager 实现动态权限控制"><!--[--><!--]--> 自定义 AuthorizationManager 实现动态权限控制 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#准备工作-3" class="router-link-active router-link-exact-active sidebar-item" aria-label="准备工作"><!--[--><!--]--> 准备工作 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#实现-authorizationmanager-接口" class="router-link-active router-link-exact-active sidebar-item" aria-label="实现 AuthorizationManager 接口"><!--[--><!--]--> 实现 AuthorizationManager 接口 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#配置-3" class="router-link-active router-link-exact-active sidebar-item" aria-label="配置"><!--[--><!--]--> 配置 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#测试-4" class="router-link-active router-link-exact-active sidebar-item" aria-label="测试"><!--[--><!--]--> 测试 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#优化" class="router-link-active router-link-exact-active sidebar-item" aria-label="优化"><!--[--><!--]--> 优化 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#漏洞防护" class="router-link-active router-link-exact-active sidebar-item" aria-label="漏洞防护"><!--[--><!--]--> 漏洞防护 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#cors-跨域资源共享" class="router-link-active router-link-exact-active sidebar-item" aria-label="cors(跨域资源共享)"><!--[--><!--]--> cors(跨域资源共享) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#csrf-跨站请求伪造" class="router-link-active router-link-exact-active sidebar-item" aria-label="csrf(跨站请求伪造)"><!--[--><!--]--> csrf(跨站请求伪造) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#支持https" class="router-link-active router-link-exact-active sidebar-item" aria-label="支持HTTPS"><!--[--><!--]--> 支持HTTPS <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/java/springsecurity/SpringSecurity%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83.html#安全http响应头" class="router-link-active router-link-exact-active sidebar-item" aria-label="安全HTTP响应头"><!--[--><!--]--> 安全HTTP响应头 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="springsecurity实现前后端分离应用的认证与授权" tabindex="-1"><a class="header-anchor" href="#springsecurity实现前后端分离应用的认证与授权"><span>SpringSecurity实现前后端分离应用的认证与授权</span></a></h1><p>版本信息：</p><ul><li>JDK 17</li><li>Maven 3.8.2</li><li>Spring Boot 3.2.1</li><li>Spring Security 6.2.1</li><li>MyBatis 3.0.3</li></ul><h2 id="准备工作" tabindex="-1"><a class="header-anchor" href="#准备工作"><span>准备工作</span></a></h2><p>创建SpringBoot项目，并引入SpringSecurity。</p><p>添加依赖</p><div class="language-xml" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>创建启动类</p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApiSecurityApp</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ApiSecurityApp</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>创建配置文件application.properties</p><div class="language-properties" data-ext="properties" data-title="properties"><pre class="language-properties"><code><span class="token key attr-name">server.port</span><span class="token punctuation">=</span><span class="token value attr-value">8080</span>
</code></pre></div><h2 id="创建springsecurity配置类" tabindex="-1"><a class="header-anchor" href="#创建springsecurity配置类"><span>创建SpringSecurity配置类</span></a></h2><p>创建配置类，并使用 <code>@EnableWebSecurity</code> 注解，然后注入一个 <code>SecurityFilterChain</code> 的Bean</p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableWebSecurity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApiSecurityConfiguration</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">filterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>为了方便测试，自定义一个用户，保存在内存中</p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">UserDetailsService</span> <span class="token function">userDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">UserDetails</span> admin <span class="token operator">=</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">username</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">&quot;USER&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ADMIN&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span>admin<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="自定义登录认证逻辑" tabindex="-1"><a class="header-anchor" href="#自定义登录认证逻辑"><span>自定义登录认证逻辑</span></a></h2><h3 id="定义-authentication" tabindex="-1"><a class="header-anchor" href="#定义-authentication"><span>定义 <code>Authentication</code></span></a></h3><p>用于存储用户信息。</p><p>继承 <code>AbstractAuthenticationToken</code> 抽象类。</p><blockquote><p>参考 <code>UsernamePasswordAuthenticationToken</code></p></blockquote><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountPasswordAuthenticationToken</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractAuthenticationToken</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Serial</span> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">20230101000000L</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> principal<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Object</span> credentials<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">AccountPasswordAuthenticationToken</span><span class="token punctuation">(</span><span class="token class-name">Object</span> principal<span class="token punctuation">,</span> <span class="token class-name">Object</span> credentials<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>principal <span class="token operator">=</span> principal<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>credentials <span class="token operator">=</span> credentials<span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setAuthenticated</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">AccountPasswordAuthenticationToken</span><span class="token punctuation">(</span><span class="token class-name">Object</span> principal<span class="token punctuation">,</span> <span class="token class-name">Object</span> credentials<span class="token punctuation">,</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> authorities<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>authorities<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>principal <span class="token operator">=</span> principal<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>credentials <span class="token operator">=</span> credentials<span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setAuthenticated</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> principal<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> credentials<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="定义登录认证-filter" tabindex="-1"><a class="header-anchor" href="#定义登录认证-filter"><span>定义登录认证 <code>Filter</code></span></a></h3><p>拦截登录请求，从请求中获取认证信息，封装为 <code>Authentication</code> 对象，最终由 <code>AuthenticationManager</code> 调用相应的 <code>AuthenticationProvider</code> 进行具体的认证逻辑。</p><p>继承 <code>AbstractAuthenticationProcessingFilter</code> 抽象类。</p><blockquote><p>参考 <code>UsernamePasswordAuthenticationFilter</code></p></blockquote><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountPasswordAuthenticationFilter</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractAuthenticationProcessingFilter</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">SPRING_SECURITY_USERNAME_KEY</span> <span class="token operator">=</span> <span class="token string">&quot;account&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">SPRING_SECURITY_PASSWORD_KEY</span> <span class="token operator">=</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">AntPathRequestMatcher</span> <span class="token constant">DEFAULT_ANT_PATH_REQUEST_MATCHER</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AntPathRequestMatcher</span><span class="token punctuation">(</span><span class="token string">&quot;/api/v1/login&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> usernameParameter <span class="token operator">=</span> <span class="token constant">SPRING_SECURITY_USERNAME_KEY</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> passwordParameter <span class="token operator">=</span> <span class="token constant">SPRING_SECURITY_PASSWORD_KEY</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">boolean</span> postOnly <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ObjectMapper</span> objectMapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">AccountPasswordAuthenticationFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_ANT_PATH_REQUEST_MATCHER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">AccountPasswordAuthenticationFilter</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationManager</span> authenticationManager<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_ANT_PATH_REQUEST_MATCHER</span><span class="token punctuation">,</span> authenticationManager<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Authentication</span> <span class="token function">attemptAuthentication</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 只允许POST请求</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>postOnly <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AuthenticationServiceException</span><span class="token punctuation">(</span><span class="token string">&quot;Authentication method not supported: &quot;</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 只接收JSON数据</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON_VALUE</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AuthenticationServiceException</span><span class="token punctuation">(</span><span class="token string">&quot;Authentication content-type not supported: &quot;</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 从请求中获取登录认证数据</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> requestBody <span class="token operator">=</span> <span class="token function">obtainRequestBody</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> requestBody<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>usernameParameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        username <span class="token operator">=</span> <span class="token punctuation">(</span>username <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> username<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> password <span class="token operator">=</span> requestBody<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>passwordParameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        password <span class="token operator">=</span> <span class="token punctuation">(</span>password <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> password<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

        <span class="token class-name">AccountPasswordAuthenticationToken</span> authentication <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AccountPasswordAuthenticationToken</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAuthenticationManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span>authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">obtainRequestBody</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">ServletInputStream</span> in <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> objectMapper<span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TypeReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUsernameParameter</span><span class="token punctuation">(</span><span class="token class-name">String</span> usernameParameter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>usernameParameter <span class="token operator">=</span> usernameParameter<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPasswordParameter</span><span class="token punctuation">(</span><span class="token class-name">String</span> passwordParameter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>passwordParameter <span class="token operator">=</span> passwordParameter<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPostOnly</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> postOnly<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>postOnly <span class="token operator">=</span> postOnly<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="定义-authenticationprovider" tabindex="-1"><a class="header-anchor" href="#定义-authenticationprovider"><span>定义 <code>AuthenticationProvider</code></span></a></h3><p>负责具体的认证逻辑，使用 <code>UserDetailsService</code> 和 <code>PasswordEncoder</code> 来验证用户名和密码。</p><p>实现 <code>AuthenticationProvider</code> 接口。</p><blockquote><p>参考 <code>AbstractUserDetailsAuthenticationProvider</code> 及其子类 <code>DaoAuthenticationProvider</code></p></blockquote><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountPasswordAuthenticationProvider</span> <span class="token keyword">implements</span> <span class="token class-name">AuthenticationProvider</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">PasswordEncoder</span> passwordEncoder<span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token class-name">UserDetailsService</span> userDetailsService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Authentication</span> <span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token class-name">Authentication</span> authentication<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 查询用户</span>
        <span class="token class-name">UserDetails</span> userDetails <span class="token operator">=</span> <span class="token function">retrieveUser</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 其它认证检查(用户是否禁用, 是否过期, 密码是否正确等)</span>
        <span class="token function">additionalAuthenticationChecks</span><span class="token punctuation">(</span>userDetails<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">AccountPasswordAuthenticationToken</span><span class="token punctuation">)</span>authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 认证通过, 返回Authentication对象</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AccountPasswordAuthenticationToken</span><span class="token punctuation">(</span>userDetails<span class="token punctuation">,</span> authentication<span class="token punctuation">.</span><span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userDetails<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">supports</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> authentication<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">AccountPasswordAuthenticationToken</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">UserDetails</span> <span class="token function">retrieveUser</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> userDetailsService<span class="token punctuation">.</span><span class="token function">loadUserByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">UsernameNotFoundException</span> ex<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UsernameNotFoundException</span><span class="token punctuation">(</span><span class="token string">&quot;用户不存在&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InternalAuthenticationServiceException</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">additionalAuthenticationChecks</span><span class="token punctuation">(</span><span class="token class-name">UserDetails</span> userDetails<span class="token punctuation">,</span>
            <span class="token class-name">AccountPasswordAuthenticationToken</span> authentication<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>authentication<span class="token punctuation">.</span><span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BadCredentialsException</span><span class="token punctuation">(</span><span class="token string">&quot;密码为空&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">String</span> presentedPassword <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>passwordEncoder<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>presentedPassword<span class="token punctuation">,</span> userDetails<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BadCredentialsException</span><span class="token punctuation">(</span><span class="token string">&quot;密码不匹配&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>userDetails<span class="token punctuation">.</span><span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">DisabledException</span><span class="token punctuation">(</span><span class="token string">&quot;账号已被禁用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>userDetails<span class="token punctuation">.</span><span class="token function">isAccountNonLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">LockedException</span><span class="token punctuation">(</span><span class="token string">&quot;账号已被锁定&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>userDetails<span class="token punctuation">.</span><span class="token function">isAccountNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AccountExpiredException</span><span class="token punctuation">(</span><span class="token string">&quot;账号已过期&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>userDetails<span class="token punctuation">.</span><span class="token function">isCredentialsNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">CredentialsExpiredException</span><span class="token punctuation">(</span><span class="token string">&quot;密码已过期&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPasswordEncoder</span><span class="token punctuation">(</span><span class="token class-name">PasswordEncoder</span> passwordEncoder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>passwordEncoder <span class="token operator">=</span> passwordEncoder<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUserDetailsService</span><span class="token punctuation">(</span><span class="token class-name">UserDetailsService</span> userDetailsService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userDetailsService <span class="token operator">=</span> userDetailsService<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="定义认证成功-失败处理器" tabindex="-1"><a class="header-anchor" href="#定义认证成功-失败处理器"><span>定义认证成功/失败处理器</span></a></h3><p>认证成功处理器，实现 <code>AuthenticationSuccessHandler</code> 接口</p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomAuthenticationSuccessHandler</span> <span class="token keyword">implements</span> <span class="token class-name">AuthenticationSuccessHandler</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ObjectMapper</span> objectMapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAuthenticationSuccess</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Authentication</span> authentication<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">.</span><span class="token function">displayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> body <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
            <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;登录成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>认证失败处理器，实现 <code>AuthenticationFailureHandler</code> 接口</p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomAuthenticationFailureHandler</span> <span class="token keyword">implements</span> <span class="token class-name">AuthenticationFailureHandler</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ObjectMapper</span> objectMapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAuthenticationFailure</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">AuthenticationException</span> exception<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">UNAUTHORIZED</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">.</span><span class="token function">displayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> body <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
            <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> exception<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="配置认证信息" tabindex="-1"><a class="header-anchor" href="#配置认证信息"><span>配置认证信息</span></a></h3><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableWebSecurity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApiSecurityConfiguration</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">filterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        http<span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorizeHttpRequests <span class="token operator">-&gt;</span> authorizeHttpRequests<span class="token punctuation">.</span><span class="token function">requestMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/api/v1/login&quot;</span><span class="token punctuation">)</span>
                                                                                 <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                                                                 <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                                                                 <span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 配置Filter</span>
        http<span class="token punctuation">.</span><span class="token function">addFilterAt</span><span class="token punctuation">(</span><span class="token function">accountPasswordAuthenticationFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">UsernamePasswordAuthenticationFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 配置AuthenticationProvider</span>
        http<span class="token punctuation">.</span><span class="token function">authenticationProvider</span><span class="token punctuation">(</span><span class="token function">accountPasswordAuthenticationProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 禁用Session</span>
        http<span class="token punctuation">.</span><span class="token function">sessionManagement</span><span class="token punctuation">(</span>session <span class="token operator">-&gt;</span> session<span class="token punctuation">.</span><span class="token function">sessionCreationPolicy</span><span class="token punctuation">(</span><span class="token class-name">SessionCreationPolicy</span><span class="token punctuation">.</span><span class="token constant">STATELESS</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 禁用csrf保护</span>
        http<span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetailsService</span> <span class="token function">userDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">UserDetails</span> admin <span class="token operator">=</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">username</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">&quot;USER&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ADMIN&quot;</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span>admin<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * PasswordEncoder
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">NoOpPasswordEncoder</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 注入AuthenticationConfiguration, 用于获取AuthenticationManager
     */</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AuthenticationConfiguration</span> authenticationConfiguration<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * AuthenticationManager
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">AuthenticationManager</span> <span class="token function">authenticationManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>authenticationConfiguration<span class="token punctuation">.</span><span class="token function">getAuthenticationManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Filter: 账号密码认证过滤器
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">AccountPasswordAuthenticationFilter</span> <span class="token function">accountPasswordAuthenticationFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">AccountPasswordAuthenticationFilter</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AccountPasswordAuthenticationFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filter<span class="token punctuation">.</span><span class="token function">setAuthenticationManager</span><span class="token punctuation">(</span><span class="token function">authenticationManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filter<span class="token punctuation">.</span><span class="token function">setAuthenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token function">authenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filter<span class="token punctuation">.</span><span class="token function">setAuthenticationFailureHandler</span><span class="token punctuation">(</span><span class="token function">authenticationFailureHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> filter<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * AuthenticationProvider: 账号密码认证Provider
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">AccountPasswordAuthenticationProvider</span> <span class="token function">accountPasswordAuthenticationProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">AccountPasswordAuthenticationProvider</span> provider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AccountPasswordAuthenticationProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        provider<span class="token punctuation">.</span><span class="token function">setPasswordEncoder</span><span class="token punctuation">(</span><span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        provider<span class="token punctuation">.</span><span class="token function">setUserDetailsService</span><span class="token punctuation">(</span><span class="token function">userDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> provider<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 认证成功处理器
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">CustomAuthenticationSuccessHandler</span> <span class="token function">authenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CustomAuthenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 认证失败处理器
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">CustomAuthenticationFailureHandler</span> <span class="token function">authenticationFailureHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CustomAuthenticationFailureHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="测试" tabindex="-1"><a class="header-anchor" href="#测试"><span>测试</span></a></h3><p>输入错误的用户名</p><p><img src="/assets/20231228184120-a-oz1IIy.png" alt=""></p><p>输入错误的密码</p><p><img src="/assets/20231228184252-nOW6Obwg.png" alt=""></p><p>输入正确的用户名和密码</p><p><img src="/assets/20231228184320-44bzJeLW.png" alt=""></p><h2 id="密码加密" tabindex="-1"><a class="header-anchor" href="#密码加密"><span>密码加密</span></a></h2><p>注入一个 <code>PasswordEncoder</code> 接口实现类的Bean</p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// return NoOpPasswordEncoder.getInstance();</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用 <code>encode(rowPassword)</code> 方法加密，使用 <code>matches(rawPassword, encodedPassword)</code> 方法匹配密码。</p><h2 id="自定义认证数据源" tabindex="-1"><a class="header-anchor" href="#自定义认证数据源"><span>自定义认证数据源</span></a></h2><h3 id="准备工作-1" tabindex="-1"><a class="header-anchor" href="#准备工作-1"><span>准备工作</span></a></h3><p><strong>建表: RBAC权限模型</strong></p><p>经典的RBAC权限模型，需要5张表：用户表、角色表、权限表、用户-角色关系表、角色-权限关系表。</p><p><img src="/assets/20231229132421-P-AUNqJz.png" alt=""></p><p><strong>集成MyBatis</strong></p><p>添加依赖</p><div class="language-xml" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>配置数据源和mybatis</p><div class="language-properties" data-ext="properties" data-title="properties"><pre class="language-properties"><code><span class="token key attr-name">spring.datasource.driver-class-name</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.cj.jdbc.Driver</span>
<span class="token key attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://localhost:3306/study?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai</span>
<span class="token key attr-name">spring.datasource.username</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">spring.datasource.password</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>

<span class="token key attr-name">mybatis.type-aliases-package</span><span class="token punctuation">=</span><span class="token value attr-value">me.lyp.api.entity</span>
<span class="token key attr-name">mybatis.mapper-locations</span><span class="token punctuation">=</span><span class="token value attr-value">classpath:/mapper/*.xml</span>
<span class="token key attr-name">mybatis.configuration.map-underscore-to-camel-case</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token key attr-name">mybatis.configuration.log-impl</span><span class="token punctuation">=</span><span class="token value attr-value">org.apache.ibatis.logging.slf4j.Slf4jImpl</span>
</code></pre></div><p><strong>编写代码</strong></p><p>创建与数据表对应的实体类</p><p>(略)</p><p>创建用户Mapper接口以及相应的xml映射文件，添加根据用户名查询用户及其角色和权限的方法</p><p><em>UserMapper.java</em></p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token punctuation">{</span>
    <span class="token class-name">User</span> <span class="token function">selectOneByUsername</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em>UserMapper.xml</em></p><div class="language-xml" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span>
        <span class="token name">PUBLIC</span> <span class="token string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
        <span class="token string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>me.lyp.api.mapper.UserMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userResultMap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>User<span class="token punctuation">&quot;</span></span> <span class="token attr-name">autoMapping</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>roles<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Role<span class="token punctuation">&quot;</span></span> <span class="token attr-name">columnPrefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>r_<span class="token punctuation">&quot;</span></span> <span class="token attr-name">autoMapping</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>code<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>code<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>permissions<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Permission<span class="token punctuation">&quot;</span></span> <span class="token attr-name">columnPrefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>p_<span class="token punctuation">&quot;</span></span> <span class="token attr-name">autoMapping</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>code<span class="token punctuation">&quot;</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>code<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>selectOneByUsername<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>string<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userResultMap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        WITH cte_user AS(
        SELECT *
        FROM `t_user`
        WHERE username = #{username}
        LIMIT 1
        )

        SELECT cte_user.*,
        t2.code     AS r_code,
        t2.remark   AS r_remark,
        t4.code     AS p_code,
        t4.remark   AS p_remark
        FROM cte_user LEFT JOIN t_user_role AS t1 ON cte_user.username = t1.username
        LEFT JOIN t_role AS t2 ON t1.role_code = t2.code
        LEFT JOIN t_role_permission AS t3 ON t2.code = t3.role_code
        LEFT JOIN t_permission AS t4 ON t3.permission_code = t4.code
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="定义-userdetails" tabindex="-1"><a class="header-anchor" href="#定义-userdetails"><span>定义 <code>UserDetails</code></span></a></h3><p><code>UserDetails</code> 用于存储用户信息，这些信息将被封装为 <code>Authentication</code> 对象。</p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomUserDetails</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetails</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">User</span> user<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">CustomUserDetails</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>user <span class="token operator">=</span> user<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 返回用户权限集合，包括role和scope，role需要以ROLE_开头
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SimpleGrantedAuthority</span><span class="token punctuation">&gt;</span></span> authorities <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">&gt;</span></span> roles <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getRoles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Permission</span><span class="token punctuation">&gt;</span></span> permissions <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getPermissions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>roles<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SimpleGrantedAuthority</span><span class="token punctuation">&gt;</span></span> roleSet <span class="token operator">=</span> roles<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                                       <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>role <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">SimpleGrantedAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;ROLE_&quot;</span> <span class="token operator">+</span> role<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                                       <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            authorities<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>roleSet<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>permissions<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SimpleGrantedAuthority</span><span class="token punctuation">&gt;</span></span> permissionSet <span class="token operator">=</span> permissions<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                                                   <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>permission <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">SimpleGrantedAuthority</span><span class="token punctuation">(</span>permission<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                                                   <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            authorities<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>permissionSet<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> authorities<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isAccountNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isAccountNonLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isCredentialsNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> user<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="定义-userdetailsservice" tabindex="-1"><a class="header-anchor" href="#定义-userdetailsservice"><span>定义 <code>UserDetailsService</code></span></a></h3><p><code>UserDetailsService</code> 是加载特定用户的核心接口，在SpringSecurity框架中作为用户数据访问对象(DAO)</p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomUserDetailsService</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">CustomUserDetailsService</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userMapper <span class="token operator">=</span> userMapper<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectOneByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UsernameNotFoundException</span><span class="token punctuation">(</span><span class="token string">&quot;用户不存在&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CustomUserDetails</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="配置" tabindex="-1"><a class="header-anchor" href="#配置"><span>配置</span></a></h3><p>向Spring容器中注入自定义的 <code>UserDetailsService</code> Bean即可</p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">/*
@Bean
public UserDetailsService userDetailsService() {
    UserDetails admin = User.builder()
                            .username(&quot;admin&quot;)
                            .password(&quot;$2a$10$vszQ9UpM4zeouQNoLWWAyOlsIuWxxcHY9zSwseN95ZihkLCgGbh4.&quot;)
                            .roles(&quot;USER&quot;, &quot;ADMIN&quot;)
                            .build();

    return new InMemoryUserDetailsManager(admin);
}
*/</span>

<span class="token annotation punctuation">@Resource</span>
<span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">CustomUserDetailsService</span> <span class="token function">userDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CustomUserDetailsService</span><span class="token punctuation">(</span>userMapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="通过多条filter链支持多用户表认证" tabindex="-1"><a class="header-anchor" href="#通过多条filter链支持多用户表认证"><span>通过多条Filter链支持多用户表认证</span></a></h2><blockquote><p>以面向门户网站的普通用户认证和面向后台管理系统的管理员用户认证为例。</p></blockquote><h3 id="准备工作-2" tabindex="-1"><a class="header-anchor" href="#准备工作-2"><span>准备工作</span></a></h3><p><strong>建表</strong></p><p>创建管理员用户表（略）</p><p><strong>创建管理员用户表对应的实体类</strong></p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AdminUser</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>创建Mapper接口以及xml映射文件</strong></p><blockquote><p>这里作为测试，并没有真的创建表，而是直接在sql中返回模拟用户数据</p></blockquote><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AdminUserMapper</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token triple-quoted-string string">&quot;&quot;&quot;
            SELECT &#39;admin&#39; AS username,
                   &#39;$2a$10$OsizY1GBMmBPtwNiH0GyLezMgMaqV9ESoGOhKzAnnmVtRD.5orMyu&#39; AS `password`
            FROM DUAL
            &quot;&quot;&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">AdminUser</span> <span class="token function">selectOneByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="定义-userdetails-和-userdetailsservice-的实现类" tabindex="-1"><a class="header-anchor" href="#定义-userdetails-和-userdetailsservice-的实现类"><span>定义 <code>UserDetails</code> 和 <code>UserDetailsService</code> 的实现类</span></a></h3><p><em>CustomAdminUserDetails</em></p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomAdminUserDetails</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetails</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AdminUser</span> user<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">CustomAdminUserDetails</span><span class="token punctuation">(</span><span class="token class-name">AdminUser</span> user<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>user <span class="token operator">=</span> user<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> authorities <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> authorities<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isAccountNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isAccountNonLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isCredentialsNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em>CustomAdminUserDetailsService</em></p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomAdminUserDetailsService</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AdminUserMapper</span> adminUserMapper<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">CustomAdminUserDetailsService</span><span class="token punctuation">(</span><span class="token class-name">AdminUserMapper</span> adminUserMapper<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>adminUserMapper <span class="token operator">=</span> adminUserMapper<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token class-name">AdminUser</span> user <span class="token operator">=</span> adminUserMapper<span class="token punctuation">.</span><span class="token function">selectOneByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UsernameNotFoundException</span><span class="token punctuation">(</span><span class="token string">&quot;用户不存在&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CustomAdminUserDetails</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="定义-authentication-filter-authenticationprovider-的实现类" tabindex="-1"><a class="header-anchor" href="#定义-authentication-filter-authenticationprovider-的实现类"><span>定义 <code>Authentication</code>，<code>Filter</code>，<code>AuthenticationProvider</code> 的实现类</span></a></h3><p><strong><code>Authentication</code></strong> 直接使用SpringSecurity自带的 <code>UsernamePasswordAuthenticationToken</code>。</p><p><em>AdminUsernamePasswordAuthenticationFilter</em></p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AdminUsernamePasswordAuthenticationFilter</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractAuthenticationProcessingFilter</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">SPRING_SECURITY_USERNAME_KEY</span> <span class="token operator">=</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">SPRING_SECURITY_PASSWORD_KEY</span> <span class="token operator">=</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">AntPathRequestMatcher</span> <span class="token constant">DEFAULT_ANT_PATH_REQUEST_MATCHER</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AntPathRequestMatcher</span><span class="token punctuation">(</span><span class="token string">&quot;/admin/login&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> usernameParameter <span class="token operator">=</span> <span class="token constant">SPRING_SECURITY_USERNAME_KEY</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> passwordParameter <span class="token operator">=</span> <span class="token constant">SPRING_SECURITY_PASSWORD_KEY</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">boolean</span> postOnly <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ObjectMapper</span> objectMapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">AdminUsernamePasswordAuthenticationFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_ANT_PATH_REQUEST_MATCHER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">AdminUsernamePasswordAuthenticationFilter</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationManager</span> authenticationManager<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_ANT_PATH_REQUEST_MATCHER</span><span class="token punctuation">,</span> authenticationManager<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Authentication</span> <span class="token function">attemptAuthentication</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 只允许POST请求</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>postOnly <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AuthenticationServiceException</span><span class="token punctuation">(</span><span class="token string">&quot;Authentication method not supported: &quot;</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 只接收JSON数据</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON_VALUE</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AuthenticationServiceException</span><span class="token punctuation">(</span><span class="token string">&quot;Authentication content-type not supported: &quot;</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 从请求中获取登录认证数据</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> requestBody <span class="token operator">=</span> <span class="token function">obtainRequestBody</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> requestBody<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>usernameParameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        username <span class="token operator">=</span> <span class="token punctuation">(</span>username <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> username<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> password <span class="token operator">=</span> requestBody<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>passwordParameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        password <span class="token operator">=</span> <span class="token punctuation">(</span>password <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> password<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

        <span class="token class-name">UsernamePasswordAuthenticationToken</span> authentication <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAuthenticationManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span>authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">obtainRequestBody</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">ServletInputStream</span> in <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> objectMapper<span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TypeReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUsernameParameter</span><span class="token punctuation">(</span><span class="token class-name">String</span> usernameParameter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>usernameParameter <span class="token operator">=</span> usernameParameter<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPasswordParameter</span><span class="token punctuation">(</span><span class="token class-name">String</span> passwordParameter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>passwordParameter <span class="token operator">=</span> passwordParameter<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPostOnly</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> postOnly<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>postOnly <span class="token operator">=</span> postOnly<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em>AdminUsernamePasswordAuthenticationProvider</em></p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AdminUsernamePasswordAuthenticationProvider</span> <span class="token keyword">implements</span> <span class="token class-name">AuthenticationProvider</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">PasswordEncoder</span> passwordEncoder<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">UserDetailsService</span> userDetailsService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Authentication</span> <span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token class-name">Authentication</span> authentication<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 查询用户</span>
        <span class="token class-name">UserDetails</span> userDetails <span class="token operator">=</span> <span class="token function">retrieveUser</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 其它认证检查(用户是否禁用, 是否过期, 密码是否正确等)</span>
        <span class="token function">additionalAuthenticationChecks</span><span class="token punctuation">(</span>userDetails<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">)</span>authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 认证通过, 返回Authentication对象</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">(</span>userDetails<span class="token punctuation">,</span> authentication<span class="token punctuation">.</span><span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userDetails<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">supports</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> authentication<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">UserDetails</span> <span class="token function">retrieveUser</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> userDetailsService<span class="token punctuation">.</span><span class="token function">loadUserByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">UsernameNotFoundException</span> ex<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UsernameNotFoundException</span><span class="token punctuation">(</span><span class="token string">&quot;用户不存在&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InternalAuthenticationServiceException</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">additionalAuthenticationChecks</span><span class="token punctuation">(</span><span class="token class-name">UserDetails</span> userDetails<span class="token punctuation">,</span>
            <span class="token class-name">UsernamePasswordAuthenticationToken</span> authentication<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>authentication<span class="token punctuation">.</span><span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BadCredentialsException</span><span class="token punctuation">(</span><span class="token string">&quot;密码为空&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">String</span> presentedPassword <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>passwordEncoder<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>presentedPassword<span class="token punctuation">,</span> userDetails<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BadCredentialsException</span><span class="token punctuation">(</span><span class="token string">&quot;密码不匹配&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>userDetails<span class="token punctuation">.</span><span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">DisabledException</span><span class="token punctuation">(</span><span class="token string">&quot;账号已被禁用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>userDetails<span class="token punctuation">.</span><span class="token function">isAccountNonLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">LockedException</span><span class="token punctuation">(</span><span class="token string">&quot;账号已被锁定&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>userDetails<span class="token punctuation">.</span><span class="token function">isAccountNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AccountExpiredException</span><span class="token punctuation">(</span><span class="token string">&quot;账号已过期&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>userDetails<span class="token punctuation">.</span><span class="token function">isCredentialsNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">CredentialsExpiredException</span><span class="token punctuation">(</span><span class="token string">&quot;密码已过期&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPasswordEncoder</span><span class="token punctuation">(</span><span class="token class-name">PasswordEncoder</span> passwordEncoder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>passwordEncoder <span class="token operator">=</span> passwordEncoder<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUserDetailsService</span><span class="token punctuation">(</span><span class="token class-name">UserDetailsService</span> userDetailsService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userDetailsService <span class="token operator">=</span> userDetailsService<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="配置多个-authenticationmanager-bean和多条filter链" tabindex="-1"><a class="header-anchor" href="#配置多个-authenticationmanager-bean和多条filter链"><span>配置多个 <code>AuthenticationManager</code> Bean和多条Filter链</span></a></h3><p><strong>配置多个的 <code>AuthenticationManager</code></strong></p><p>不同的Filter链，需要使用不同的 <code>AuthenticationManager</code> ，来管理一个或多个 <code>AuthenticationProvider</code>。使用其实现类 <code>ProviderManager</code> 即可。</p><blockquote><p>注意：有多个 <code>AuthenticationManager</code> Bean时，需要使用原生注解 <code>@Primary</code> 指定默认的Bean</p></blockquote><p>这里配置2个 <code>AuthenticationManager</code> Bean：</p><p>普通用户认证</p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Primary</span>
<span class="token keyword">public</span> <span class="token class-name">AuthenticationManager</span> <span class="token function">authenticationManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ProviderManager</span><span class="token punctuation">(</span><span class="token function">accountPasswordAuthenticationProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * AuthenticationProvider: 普通用户账号密码认证Provider
 */</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">AuthenticationProvider</span> <span class="token function">accountPasswordAuthenticationProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">AccountPasswordAuthenticationProvider</span> provider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AccountPasswordAuthenticationProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    provider<span class="token punctuation">.</span><span class="token function">setPasswordEncoder</span><span class="token punctuation">(</span><span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    provider<span class="token punctuation">.</span><span class="token function">setUserDetailsService</span><span class="token punctuation">(</span><span class="token function">userDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> provider<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Resource</span> <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">CustomUserDetailsService</span> <span class="token function">userDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CustomUserDetailsService</span><span class="token punctuation">(</span>userMapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>管理员用户认证</p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 创建AuthenticationManager
 */</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">AuthenticationManager</span> <span class="token function">adminAuthenticationManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ProviderManager</span><span class="token punctuation">(</span><span class="token function">adminUsernamePasswordAuthenticationProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * AuthenticationProvider: 管理员用户名密码认证Provider
 */</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">AuthenticationProvider</span> <span class="token function">adminUsernamePasswordAuthenticationProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">AdminUsernamePasswordAuthenticationProvider</span> provider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AdminUsernamePasswordAuthenticationProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    provider<span class="token punctuation">.</span><span class="token function">setPasswordEncoder</span><span class="token punctuation">(</span><span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    provider<span class="token punctuation">.</span><span class="token function">setUserDetailsService</span><span class="token punctuation">(</span><span class="token function">adminUserDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> provider<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Resource</span> <span class="token keyword">private</span> <span class="token class-name">AdminUserMapper</span> adminUserMapper<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">UserDetailsService</span> <span class="token function">adminUserDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CustomAdminUserDetailsService</span><span class="token punctuation">(</span>adminUserMapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>配置多条Filter链</strong></p><p>多条Filter链，每条链执行不同的认证逻辑。使用 <code>HttpSecurity#securityMatchers</code> 方法可以限制当前Filter链能处理的HTTP请求URL。</p><p>这里配置2条Filter链：</p><p>普通用户认证Filter链</p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">defaultFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// 匹配 /api 开头的请求</span>
    http<span class="token punctuation">.</span><span class="token function">securityMatchers</span><span class="token punctuation">(</span>matcher <span class="token operator">-&gt;</span> matcher<span class="token punctuation">.</span><span class="token function">requestMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/api/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/api/v1/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorizeHttpRequests <span class="token operator">-&gt;</span> authorizeHttpRequests<span class="token punctuation">.</span><span class="token function">requestMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/api/v1/login&quot;</span><span class="token punctuation">)</span>
                               <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                               <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                               <span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 配置Filter</span>
    http<span class="token punctuation">.</span><span class="token function">addFilterAt</span><span class="token punctuation">(</span><span class="token function">accountPasswordAuthenticationFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">UsernamePasswordAuthenticationFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    http<span class="token punctuation">.</span><span class="token function">sessionManagement</span><span class="token punctuation">(</span>session <span class="token operator">-&gt;</span> session<span class="token punctuation">.</span><span class="token function">sessionCreationPolicy</span><span class="token punctuation">(</span><span class="token class-name">SessionCreationPolicy</span><span class="token punctuation">.</span><span class="token constant">STATELESS</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    http<span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Filter</span> <span class="token function">accountPasswordAuthenticationFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">AccountPasswordAuthenticationFilter</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AccountPasswordAuthenticationFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    filter<span class="token punctuation">.</span><span class="token function">setAuthenticationManager</span><span class="token punctuation">(</span><span class="token function">authenticationManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    filter<span class="token punctuation">.</span><span class="token function">setAuthenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token function">authenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    filter<span class="token punctuation">.</span><span class="token function">setAuthenticationFailureHandler</span><span class="token punctuation">(</span><span class="token function">authenticationFailureHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> filter<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>管理员用户认证Filter链</p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">adminFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// 匹配 /admin 开头的请求</span>
    http<span class="token punctuation">.</span><span class="token function">securityMatchers</span><span class="token punctuation">(</span>matcher <span class="token operator">-&gt;</span> matcher<span class="token punctuation">.</span><span class="token function">requestMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/admin/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize<span class="token punctuation">.</span><span class="token function">requestMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/admin/login&quot;</span><span class="token punctuation">)</span>
                               <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                               <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                               <span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    http<span class="token punctuation">.</span><span class="token function">addFilterAt</span><span class="token punctuation">(</span><span class="token function">adminUsernamePasswordAuthenticationFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">UsernamePasswordAuthenticationFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    http<span class="token punctuation">.</span><span class="token function">sessionManagement</span><span class="token punctuation">(</span>session <span class="token operator">-&gt;</span> session<span class="token punctuation">.</span><span class="token function">sessionCreationPolicy</span><span class="token punctuation">(</span><span class="token class-name">SessionCreationPolicy</span><span class="token punctuation">.</span><span class="token constant">STATELESS</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    http<span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Filter</span> <span class="token function">adminUsernamePasswordAuthenticationFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">AdminUsernamePasswordAuthenticationFilter</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AdminUsernamePasswordAuthenticationFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    filter<span class="token punctuation">.</span><span class="token function">setAuthenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token function">authenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    filter<span class="token punctuation">.</span><span class="token function">setAuthenticationFailureHandler</span><span class="token punctuation">(</span><span class="token function">authenticationFailureHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    filter<span class="token punctuation">.</span><span class="token function">setAuthenticationManager</span><span class="token punctuation">(</span><span class="token function">adminAuthenticationManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> filter<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="测试-1" tabindex="-1"><a class="header-anchor" href="#测试-1"><span>测试</span></a></h3><p>普通用户登录</p><p><img src="/assets/20231230175419-wV0VULfl.png" alt=""></p><p>管理员用户登录</p><p><img src="/assets/20231230175450-lY32h2wT.png" alt=""></p><h2 id="实现jwt认证" tabindex="-1"><a class="header-anchor" href="#实现jwt认证"><span>实现JWT认证</span></a></h2><h3 id="添加jwt依赖" tabindex="-1"><a class="header-anchor" href="#添加jwt依赖"><span>添加jwt依赖</span></a></h3><blockquote><p>https://github.com/jwtk/jjwt</p></blockquote><div class="language-xml" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.jsonwebtoken<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jjwt-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.12.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.jsonwebtoken<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jjwt-impl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.12.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.jsonwebtoken<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jjwt-jackson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- or jjwt-gson if Gson is preferred --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.12.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- Uncomment this next dependency if you are using:
     - JDK 10 or earlier, and you want to use RSASSA-PSS (PS256, PS384, PS512) signature algorithms.  
     - JDK 10 or earlier, and you want to use EdECDH (X25519 or X448) Elliptic Curve Diffie-Hellman encryption.
     - JDK 14 or earlier, and you want to use EdDSA (Ed25519 or Ed448) Elliptic Curve signature algorithms.    
     It is unnecessary for these algorithms on JDK 15 or later.
&lt;dependency&gt;
    &lt;groupId&gt;org.bouncycastle&lt;/groupId&gt;
    &lt;artifactId&gt;bcprov-jdk18on&lt;/artifactId&gt; or bcprov-jdk15to18 on JDK 7
    &lt;version&gt;1.76&lt;/version&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;
--&gt;</span>

</code></pre></div><h3 id="封装jwt工具类" tabindex="-1"><a class="header-anchor" href="#封装jwt工具类"><span>封装jwt工具类</span></a></h3><p>在application配置文件中，添加3个配置项</p><div class="language-properties" data-ext="properties" data-title="properties"><pre class="language-properties"><code><span class="token comment"># jwt签名密钥</span>
<span class="token key attr-name">sys.jwt.secret-key</span><span class="token punctuation">=</span><span class="token value attr-value">&lt;YOUR_SECRET&gt;</span>
<span class="token comment"># jwt访问令牌有效时间, 单位s, 30min</span>
<span class="token key attr-name">sys.jwt.access-token-duration</span><span class="token punctuation">=</span><span class="token value attr-value">1800</span>
<span class="token comment"># jwt刷新令牌有效时间, 单位s, 7day</span>
<span class="token key attr-name">sys.jwt.refresh-token-duration</span><span class="token punctuation">=</span><span class="token value attr-value">604800</span>
</code></pre></div><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JWT</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${sys.jwt.secret-key}&quot;</span><span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token class-name">String</span> secretKey<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${sys.jwt.access-token-duration}&quot;</span><span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token class-name">Integer</span> accessTokenDuration<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${sys.jwt.refresh-token-duration}&quot;</span><span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token class-name">Integer</span> refreshTokenDuration<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> iss <span class="token operator">=</span> <span class="token string">&quot;bitbitpulse.xyz&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> sub <span class="token operator">=</span> <span class="token string">&quot;sys&quot;</span><span class="token punctuation">;</span>


    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">generateAccessToken</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> claims<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">generateToken</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> claims<span class="token punctuation">,</span> accessTokenDuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">generateRefreshToken</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> claims<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">generateToken</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> claims<span class="token punctuation">,</span> refreshTokenDuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 生成Token
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">generateToken</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> claims<span class="token punctuation">,</span> <span class="token class-name">Integer</span> duration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SecretKey</span> secretKey <span class="token operator">=</span> <span class="token function">secretKey</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">long</span> now <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Date</span> iat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Date</span> exp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>now <span class="token operator">+</span> duration <span class="token operator">*</span> <span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token class-name">Jwts</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">issuer</span><span class="token punctuation">(</span>iss<span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">subject</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">signWith</span><span class="token punctuation">(</span>secretKey<span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">issuedAt</span><span class="token punctuation">(</span>iat<span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">expiration</span><span class="token punctuation">(</span>exp<span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">claims</span><span class="token punctuation">(</span>claims<span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 解析Token
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Claims</span> <span class="token function">parseToken</span><span class="token punctuation">(</span><span class="token class-name">String</span> token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SecretKey</span> secretKey <span class="token operator">=</span> <span class="token function">secretKey</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">JwtParser</span> parser <span class="token operator">=</span> <span class="token class-name">Jwts</span><span class="token punctuation">.</span><span class="token function">parser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                               <span class="token punctuation">.</span><span class="token function">requireIssuer</span><span class="token punctuation">(</span>iss<span class="token punctuation">)</span>
                               <span class="token punctuation">.</span><span class="token function">requireSubject</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span>
                               <span class="token punctuation">.</span><span class="token function">verifyWith</span><span class="token punctuation">(</span>secretKey<span class="token punctuation">)</span>
                               <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> parser<span class="token punctuation">.</span><span class="token function">parseSignedClaims</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>
                     <span class="token punctuation">.</span><span class="token function">getPayload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token doc-comment comment">/**
     * 生成签名密钥
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">secretString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SecretKey</span> secretKey <span class="token operator">=</span> <span class="token class-name">Jwts</span><span class="token punctuation">.</span><span class="token constant">SIG</span><span class="token punctuation">.</span><span class="token constant">HS256</span><span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Encoders</span><span class="token punctuation">.</span><span class="token constant">BASE64</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>secretKey<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 根据签名密钥获取SecretKey
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">SecretKey</span> <span class="token function">secretKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> secretString<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token class-name">Decoders</span><span class="token punctuation">.</span><span class="token constant">BASE64</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>secretString<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Keys</span><span class="token punctuation">.</span><span class="token function">hmacShaKeyFor</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="登录成功后生成并返回jwt令牌" tabindex="-1"><a class="header-anchor" href="#登录成功后生成并返回jwt令牌"><span>登录成功后生成并返回jwt令牌</span></a></h3><p>在处理登录的逻辑中，生成jwt令牌，并返回给客户端。这里在自定义的 <code>AuthenticationSuccessHandler</code> 中处理</p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomAuthenticationSuccessHandler</span> <span class="token keyword">implements</span> <span class="token class-name">AuthenticationSuccessHandler</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ObjectMapper</span> objectMapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">JWT</span> jwt<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">CustomAuthenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token class-name">JWT</span> jwt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>jwt <span class="token operator">=</span> jwt<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAuthenticationSuccess</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Authentication</span> authentication<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">.</span><span class="token function">displayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> body <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
            <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;登录成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// 生成JWT令牌</span>
        <span class="token class-name">String</span> accessToken <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> principal <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>principal <span class="token keyword">instanceof</span> <span class="token class-name">CustomSysUserDetails</span> userDetails<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">SysUser</span> user <span class="token operator">=</span> userDetails<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> id <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> username <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> claims <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            claims<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
            accessToken <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">generateAccessToken</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> claims<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        data<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;access_token&quot;</span><span class="token punctuation">,</span> accessToken<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="使用filter验证请求中的jwt令牌" tabindex="-1"><a class="header-anchor" href="#使用filter验证请求中的jwt令牌"><span>使用Filter验证请求中的jwt令牌</span></a></h3><p>自定义Filter，从 <em>Authorization</em> 请求头中获取令牌，从中解析出用户信息，最后封装为 <code>Authentication</code> 对象，设置到 <code>SecurityContext</code> 中。</p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JWTAuthenticationFilter</span> <span class="token keyword">extends</span> <span class="token class-name">OncePerRequestFilter</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">JWT</span> jwt<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">JWTAuthenticationFilter</span><span class="token punctuation">(</span><span class="token class-name">JWT</span> jwt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>jwt <span class="token operator">=</span> jwt<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doFilterInternal</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 已经通过其它方式认证, 直接放行</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// 从请求头中获取Token信息</span>
        <span class="token class-name">String</span> authorization <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token class-name">HttpHeaders</span><span class="token punctuation">.</span><span class="token constant">AUTHORIZATION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>authorization <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> authorization<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span>authorization<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;Bearer &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> authorization<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 从Token中解析用户信息</span>
        <span class="token class-name">Claims</span> claims <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            claims <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">parseToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">JwtException</span> ex<span class="token punctuation">)</span><span class="token punctuation">{</span>
            filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> claims<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> roleMapList <span class="token operator">=</span> claims<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;roles&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ArrayList</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> permissionMapList <span class="token operator">=</span> claims<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;permissions&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ArrayList</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">&gt;</span></span> roles <span class="token operator">=</span> roleMapList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>roleMap <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">Role</span> role <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Role</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            role<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>roleMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> role<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Permission</span><span class="token punctuation">&gt;</span></span> permissions <span class="token operator">=</span> permissionMapList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>permissionMap <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">Permission</span> permission <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Permission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            permission<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>permissionMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> permission<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setRoles</span><span class="token punctuation">(</span>roles<span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setPermissions</span><span class="token punctuation">(</span>permissions<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 认证通过, 创建Authentication, 并设置到SecurityContext中</span>
        <span class="token class-name">UserDetails</span> userDetails <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomUserDetails</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Authentication</span> authentication <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AccountPasswordAuthenticationToken</span><span class="token punctuation">(</span>userDetails<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> userDetails<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SecurityContext</span> context <span class="token operator">=</span> <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">createEmptyContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">setAuthentication</span><span class="token punctuation">(</span>authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">setContext</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>

        filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="配置-1" tabindex="-1"><a class="header-anchor" href="#配置-1"><span>配置</span></a></h3><p>将JWT过滤器添加到Filter链中</p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">defaultFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// 匹配 /api 开头的请求</span>
    http<span class="token punctuation">.</span><span class="token function">securityMatchers</span><span class="token punctuation">(</span>matcher <span class="token operator">-&gt;</span> matcher<span class="token punctuation">.</span><span class="token function">requestMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/api/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/api/v1/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorizeHttpRequests <span class="token operator">-&gt;</span> authorizeHttpRequests<span class="token punctuation">.</span><span class="token function">requestMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
                               <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                               <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                               <span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 配置Filter</span>
    http<span class="token punctuation">.</span><span class="token function">addFilterAt</span><span class="token punctuation">(</span><span class="token function">accountPasswordAuthenticationFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">UsernamePasswordAuthenticationFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    http<span class="token punctuation">.</span><span class="token function">addFilterBefore</span><span class="token punctuation">(</span><span class="token function">jwtAuthenticationFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">AccountPasswordAuthenticationFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将JWT过滤器添加到Filter链</span>

    <span class="token comment">// 其它配置...</span>

    <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Resource</span>
<span class="token keyword">public</span> <span class="token class-name">JWT</span> jwt<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Filter</span> <span class="token function">jwtAuthenticationFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JWTAuthenticationFilter</span><span class="token punctuation">(</span>jwt<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="测试-2" tabindex="-1"><a class="header-anchor" href="#测试-2"><span>测试</span></a></h3><p>请求登录接口，获取token</p><p><img src="/assets/20231231211847-4VuuQOPp.png" alt=""></p><p>请求测试接口，将token设置到 <em>Authorization</em> 请求头中</p><p><img src="/assets/20231231211954-W4_9JHfw.png" alt=""></p><h2 id="刷新jwt令牌" tabindex="-1"><a class="header-anchor" href="#刷新jwt令牌"><span>刷新jwt令牌</span></a></h2><p>使用访问令牌和刷新令牌，实现令牌自动续期。访问令牌有效期较短，刷新令牌有效期较长。访问令牌过期后，使用刷新令牌重新颁发访问令牌和刷新令牌。</p><h3 id="在jwt工具类中添加生成访问令牌和刷新令牌的方法" tabindex="-1"><a class="header-anchor" href="#在jwt工具类中添加生成访问令牌和刷新令牌的方法"><span>在JWT工具类中添加生成访问令牌和刷新令牌的方法</span></a></h3><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">generateAccessToken</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> claims<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">generateToken</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> claims<span class="token punctuation">,</span> accessTokenDuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">generateRefreshToken</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> claims<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">generateToken</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> claims<span class="token punctuation">,</span> refreshTokenDuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="在登录成功处理器中-同时生成访问令牌和刷新令牌-并返回给客户端" tabindex="-1"><a class="header-anchor" href="#在登录成功处理器中-同时生成访问令牌和刷新令牌-并返回给客户端"><span>在登录成功处理器中，同时生成访问令牌和刷新令牌，并返回给客户端</span></a></h3><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SysUserAuthenticationSuccessHandler</span> <span class="token keyword">implements</span> <span class="token class-name">AuthenticationSuccessHandler</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span> <span class="token keyword">private</span> <span class="token class-name">JWT</span> jwt<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAuthenticationSuccess</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Authentication</span> authentication<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">.</span><span class="token function">displayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> accessToken <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> refreshToken <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> principal <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>principal <span class="token keyword">instanceof</span> <span class="token class-name">CustomSysUserDetails</span> userDetails<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">SysUser</span> user <span class="token operator">=</span> userDetails<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> id <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> username <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> claims <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            claims<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
            accessToken <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">generateAccessToken</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> claims<span class="token punctuation">)</span><span class="token punctuation">;</span>
            refreshToken <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">generateRefreshToken</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> claims<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        data<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;access_token&quot;</span><span class="token punctuation">,</span> accessToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
        data<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;refresh_token&quot;</span><span class="token punctuation">,</span> refreshToken<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ApiResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token class-name">ApiResult</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> body <span class="token operator">=</span> <span class="token class-name">JSONTools</span><span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="定义filter-拦截刷新令牌的请求-验证刷新令牌并重新颁发访问令牌和刷新令牌" tabindex="-1"><a class="header-anchor" href="#定义filter-拦截刷新令牌的请求-验证刷新令牌并重新颁发访问令牌和刷新令牌"><span>定义Filter，拦截刷新令牌的请求，验证刷新令牌并重新颁发访问令牌和刷新令牌</span></a></h3><p>启用Servlet组件扫描</p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>nameGenerator <span class="token operator">=</span> <span class="token class-name">FullyQualifiedAnnotationBeanNameGenerator</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ServletComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;me.lyp.blog&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlogApp</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">BlogApp</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>定义Filter</p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@WebFilter</span><span class="token punctuation">(</span>urlPatterns <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;/sys/token&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SysUserRefreshTokenFilter</span> <span class="token keyword">extends</span> <span class="token class-name">HttpFilter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span> <span class="token keyword">private</span> <span class="token class-name">JWT</span> jwt<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">.</span><span class="token function">displayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> body <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> method <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;HTTP method not allowed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">String</span> contentType <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">&quot;application/json&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>contentType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type not supported&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// 获取refresh_token</span>
                <span class="token class-name">ServletInputStream</span> inputStream <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> requestBodyMap <span class="token operator">=</span> <span class="token class-name">JSONTools</span><span class="token punctuation">.</span><span class="token function">fromJSON</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TypeReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> refreshToken <span class="token operator">=</span> requestBodyMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;refresh_token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>refreshToken <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> refreshToken<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;刷新令牌为空&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// 解析refresh_token</span>
                <span class="token class-name">Claims</span> claims <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">parseToken</span><span class="token punctuation">(</span>refreshToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> id <span class="token operator">=</span> claims<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> username <span class="token operator">=</span> claims<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// 重新生成access_token和refresh_token</span>
                <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> newClaims <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                newClaims<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> newAccessToken <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">generateAccessToken</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> newClaims<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> newRefreshToken <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">generateRefreshToken</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> newClaims<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// 返回access_token和refresh_token</span>
                <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                data<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;access_token&quot;</span><span class="token punctuation">,</span> newAccessToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
                data<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;refresh_token&quot;</span><span class="token punctuation">,</span> newRefreshToken<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token class-name">ApiResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token class-name">ApiResult</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                body <span class="token operator">=</span> <span class="token class-name">JSONTools</span><span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;解析请求体数据出错&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">JwtException</span> <span class="token operator">|</span> <span class="token class-name">IllegalArgumentException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;刷新令牌已失效&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">ApiResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token class-name">ApiResult</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            body <span class="token operator">=</span> <span class="token class-name">JSONTools</span><span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// chain.doFilter(request, response);</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="在springsecurity过滤器链中-放行刷新令牌的url" tabindex="-1"><a class="header-anchor" href="#在springsecurity过滤器链中-放行刷新令牌的url"><span>在SpringSecurity过滤器链中，放行刷新令牌的URL</span></a></h3><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableWebSecurity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSecurityConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">sysUserSecurityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        http<span class="token punctuation">.</span><span class="token function">securityMatcher</span><span class="token punctuation">(</span><span class="token string">&quot;/sys/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/ums/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/blog/**&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize<span class="token punctuation">.</span><span class="token function">requestMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/sys/login&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/sys/token&quot;</span><span class="token punctuation">)</span>
                                                         <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                                         <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                                         <span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 其它配置...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="测试-3" tabindex="-1"><a class="header-anchor" href="#测试-3"><span>测试</span></a></h3><p><img src="/assets/20240109102813-ERQU9bnc.png" alt=""></p><h2 id="实现remember-me认证" tabindex="-1"><a class="header-anchor" href="#实现remember-me认证"><span>实现Remember-me认证</span></a></h2><p>Remember-me认证是通过向浏览器发送一个cookie来实现的，在之后的会话中，服务器会检测到cookie，由此实现自动登录功能。</p><h3 id="基于哈希简单令牌实现" tabindex="-1"><a class="header-anchor" href="#基于哈希简单令牌实现"><span>基于哈希简单令牌实现</span></a></h3><h3 id="持久化令牌实现" tabindex="-1"><a class="header-anchor" href="#持久化令牌实现"><span>持久化令牌实现</span></a></h3><h2 id="实现注销登录" tabindex="-1"><a class="header-anchor" href="#实现注销登录"><span>实现注销登录</span></a></h2><h3 id="定义注销成功处理器" tabindex="-1"><a class="header-anchor" href="#定义注销成功处理器"><span>定义注销成功处理器</span></a></h3><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultLogoutSuccessHandler</span> <span class="token keyword">implements</span> <span class="token class-name">LogoutSuccessHandler</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onLogoutSuccess</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Authentication</span> authentication<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">.</span><span class="token function">displayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ApiResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token class-name">ApiResult</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;已注销&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> body <span class="token operator">=</span> <span class="token class-name">JSONTools</span><span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="配置-2" tabindex="-1"><a class="header-anchor" href="#配置-2"><span>配置</span></a></h3><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">sysUserSecurityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
	<span class="token comment">// 其它配置...</span>
    
    <span class="token comment">// 注销</span>
    <span class="token class-name">LogoutHandler</span> headerWriterLogoutHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HeaderWriterLogoutHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClearSiteDataHeaderWriter</span><span class="token punctuation">(</span><span class="token class-name">ClearSiteDataHeaderWriter<span class="token punctuation">.</span>Directive</span><span class="token punctuation">.</span><span class="token constant">ALL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    http<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span>logout <span class="token operator">-&gt;</span> logout<span class="token punctuation">.</span><span class="token function">logoutUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/sys/logout&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">clearAuthentication</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">invalidateHttpSession</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addLogoutHandler</span><span class="token punctuation">(</span>headerWriterLogoutHandler<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">logoutSuccessHandler</span><span class="token punctuation">(</span><span class="token function">logoutSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">LogoutSuccessHandler</span> <span class="token function">logoutSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DefaultLogoutSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="实现强制用户下线" tabindex="-1"><a class="header-anchor" href="#实现强制用户下线"><span>实现强制用户下线</span></a></h2><h2 id="授权" tabindex="-1"><a class="header-anchor" href="#授权"><span>授权</span></a></h2><h3 id="http请求级别的权限控制" tabindex="-1"><a class="header-anchor" href="#http请求级别的权限控制"><span>HTTP请求级别的权限控制</span></a></h3><h3 id="方法级别的权限控制" tabindex="-1"><a class="header-anchor" href="#方法级别的权限控制"><span>方法级别的权限控制</span></a></h3><h2 id="自定义-authorizationmanager-实现动态权限控制" tabindex="-1"><a class="header-anchor" href="#自定义-authorizationmanager-实现动态权限控制"><span>自定义 <code>AuthorizationManager</code> 实现动态权限控制</span></a></h2><p>SpringSecurity中，访问权限是通过 <code>AuthorizationFilter</code> 过滤器控制的，这个过滤器内部又是通过调用 <code>AuthorizationManager#check</code> 方法，返回 <code>AuthorizationDecision</code> 来决定权限检查是否通过。</p><p>自定义权限控制逻辑，可以通过自定义 <code>AuthorizationManager</code> 来实现。</p><p>动态权限控制实现思路：</p><ol><li>HTTP接口URL与权限可通过配置来关联，将其存储到数据库</li><li>在 <code>AuthorizationManager</code> 中，根据URL查询访问当前接口需要的权限，如果其在当前用户所拥有的权限集合中，则权限验证通过</li><li>在Filter链中，配置使用自定义的 <code>AuthorizationManager</code> 进行权限校验</li></ol><h3 id="准备工作-3" tabindex="-1"><a class="header-anchor" href="#准备工作-3"><span>准备工作</span></a></h3><p>创建资源表</p><p><img src="/assets/20240101125002-x2kCO9oj.png" alt=""></p><p>创建资源表对应的实体，以及Mapper接口</p><p><em>资源实体</em></p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Resource</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> method<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> endpoint<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> permissionCode<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> remark<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em>资源Mapper接口</em></p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ResourceMapper</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token triple-quoted-string string">&quot;&quot;&quot;
            SELECT *
            FROM `t_resource`
            WHERE method = #{method} AND endpoint = #{endpoint}
            &quot;&quot;&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">Resource</span> <span class="token function">selectOneByMethodAndEndpoint</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;method&quot;</span><span class="token punctuation">)</span><span class="token class-name">String</span> method<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;endpoint&quot;</span><span class="token punctuation">)</span><span class="token class-name">String</span> endpoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="实现-authorizationmanager-接口" tabindex="-1"><a class="header-anchor" href="#实现-authorizationmanager-接口"><span>实现 <code>AuthorizationManager</code> 接口</span></a></h3><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DynamicAuthorizationManager</span> <span class="token keyword">implements</span> <span class="token class-name">AuthorizationManager</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RequestAuthorizationContext</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ResourceMapper</span> resourceMapper<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">DynamicAuthorizationManager</span><span class="token punctuation">(</span><span class="token class-name">ResourceMapper</span> resourceMapper<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>resourceMapper <span class="token operator">=</span> resourceMapper<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">AuthorizationDecision</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Authentication</span><span class="token punctuation">&gt;</span></span> authentication<span class="token punctuation">,</span> <span class="token class-name">RequestAuthorizationContext</span> authorizationContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">boolean</span> granted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

        <span class="token comment">// 获取当前用户拥有的权限集合</span>
        <span class="token class-name">Authentication</span> auth <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>auth <span class="token keyword">instanceof</span> <span class="token class-name">AbstractAuthenticationToken</span> authenticationToken<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> authorities <span class="token operator">=</span> authenticationToken<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 获取当前请求的HTTP方法和URL, 并查询当前资源需要的权限</span>
            <span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> authorizationContext<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> method <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> url <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getRequestURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Resource</span> resource <span class="token operator">=</span> resourceMapper<span class="token punctuation">.</span><span class="token function">selectOneByMethodAndEndpoint</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 检查当前用户拥有的权限集合中, 是否包含当前资源需要的权限</span>
            granted <span class="token operator">=</span> <span class="token function">isGranted</span><span class="token punctuation">(</span>resource<span class="token punctuation">,</span> authorities<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AuthorizationDecision</span><span class="token punctuation">(</span>granted<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">isGranted</span><span class="token punctuation">(</span><span class="token class-name">Resource</span> resource<span class="token punctuation">,</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> authorities<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>resource <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>authorities<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">String</span> permissionCode <span class="token operator">=</span> resource<span class="token punctuation">.</span><span class="token function">getPermissionCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">GrantedAuthority</span> authority <span class="token operator">:</span> authorities<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>authority<span class="token punctuation">.</span><span class="token function">getAuthority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>permissionCode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="配置-3" tabindex="-1"><a class="header-anchor" href="#配置-3"><span>配置</span></a></h3><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">defaultFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// 匹配 /api 开头的请求</span>
    http<span class="token punctuation">.</span><span class="token function">securityMatchers</span><span class="token punctuation">(</span>matcher <span class="token operator">-&gt;</span> matcher<span class="token punctuation">.</span><span class="token function">requestMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/api/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/api/v1/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorizeHttpRequests <span class="token operator">-&gt;</span> authorizeHttpRequests<span class="token punctuation">.</span><span class="token function">requestMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
                               <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                               <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                               <span class="token comment">//.authenticated()</span>
                               <span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span><span class="token function">authorizationManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用自定义AuthorizationManager</span>


    <span class="token comment">// 其它配置...</span>

    <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Resource</span>
<span class="token keyword">private</span> <span class="token class-name">ResourceMapper</span> resourceMapper<span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * AuthorizationManager: 动态权限控制管理器
 * */</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">AuthorizationManager</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RequestAuthorizationContext</span><span class="token punctuation">&gt;</span></span> <span class="token function">authorizationManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DynamicAuthorizationManager</span><span class="token punctuation">(</span>resourceMapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="测试-4" tabindex="-1"><a class="header-anchor" href="#测试-4"><span>测试</span></a></h3><p>添加一个测试控制器方法</p><div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/api/v1&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/users&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">requireAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;删除用户成功&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>请求测试接口</p><p><img src="/assets/20240101130137-9TJwt27U.png" alt=""></p><h3 id="优化" tabindex="-1"><a class="header-anchor" href="#优化"><span>优化</span></a></h3><p><strong>1.将资源权限信息缓存到Redis</strong></p><p>每次请求中，从数据库中查询资源权限，性能较低。</p><p>可以改为从Redis缓存中查询。</p><p>但是，当数据库中的资源权限改变后，会导致与Redis中的数据不一致，需要刷新缓存数据。</p><p><strong>2.将JWT令牌信息存储在Redis</strong></p><p>JWT令牌存储在客户端，用户权限改变后，令牌依然有效，从令牌中获取到的用户权限集合，与实际权限集合不一致。</p><p>可以将JWT令牌存储在Redis缓存中，当用户权限改变后，删除缓存中的令牌，强制让用户重新认证，生成新的令牌。</p><h2 id="漏洞防护" tabindex="-1"><a class="header-anchor" href="#漏洞防护"><span>漏洞防护</span></a></h2><h3 id="cors-跨域资源共享" tabindex="-1"><a class="header-anchor" href="#cors-跨域资源共享"><span>cors(跨域资源共享)</span></a></h3><h3 id="csrf-跨站请求伪造" tabindex="-1"><a class="header-anchor" href="#csrf-跨站请求伪造"><span>csrf(跨站请求伪造)</span></a></h3><h3 id="支持https" tabindex="-1"><a class="header-anchor" href="#支持https"><span>支持HTTPS</span></a></h3><h3 id="安全http响应头" tabindex="-1"><a class="header-anchor" href="#安全http响应头"><span>安全HTTP响应头</span></a></h3></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app-HBA039kk.js" defer></script>
  </body>
</html>
